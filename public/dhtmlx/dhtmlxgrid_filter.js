//v.3.5 build 120822
/*
Copyright DHTMLX LTD. http://www.dhtmlx.com
You allowed to use this component or parts of it under GPL terms
To use it on other terms or get Professional edition of the component please contact us at sales@dhtmlx.com
*/
dhtmlXGridObject.prototype.filterBy=function(e,t,n){if(this.isTreeGrid())return this.filterTreeBy(e,t,n);this._f_rowsBuffer?!n&&(this.rowsBuffer=dhtmlxArray([].concat(this._f_rowsBuffer)),this._fake)&&(this._fake.rowsBuffer=this.rowsBuffer):this._f_rowsBuffer=[].concat(this.rowsBuffer);if(this.rowsBuffer.length){var r=!0;this.dma(!0);if(typeof e=="object")for(var i=0;i<t.length;i++)this._filterA(e[i],t[i]);else this._filterA(e,t);this.dma(!1),this.pagingOn&&this.rowsBuffer.length/this.rowsBufferOutSize<this.currentPage-1&&this.changePage(0),this._reset_view(),this.callEvent("onGridReconstructed",[])}},dhtmlXGridObject.prototype._filterA=function(e,t){if(t!=""){var n=!0;typeof t=="function"?n=!1:t=(t||"").toString().toLowerCase();if(this.rowsBuffer.length)for(var r=this.rowsBuffer.length-1;r>=0;r--)(n?this._get_cell_value(this.rowsBuffer[r],e).toString().toLowerCase().indexOf(t)==-1:!t.call(this,this._get_cell_value(this.rowsBuffer[r],e),this.rowsBuffer[r].idd))&&this.rowsBuffer.splice(r,1)}},dhtmlXGridObject.prototype.getFilterElement=function(e){if(this.filters){for(var t=0;t<this.filters.length;t++)if(this.filters[t][1]==e)return this.filters[t][0].combo||this.filters[t][0];return null}},dhtmlXGridObject.prototype.collectValues=function(e){var t=this.callEvent("onCollectValues",[e]);if(t!==!0)return t;if(this.isTreeGrid())return this.collectTreeValues(e);this.dma(!0),this._build_m_order();for(var e=this._m_order?this._m_order[e]:e,n={},r=[],i=this._f_rowsBuffer||this.rowsBuffer,s=0;s<i.length;s++){var o=this._get_cell_value(i[s],e);o&&(!i[s]._childIndexes||i[s]._childIndexes[e]!=i[s]._childIndexes[e-1])&&(n[o]=!0)}this.dma(!1);var u=this.combos[e]||(this._col_combos?this._col_combos[e]:!1),a;for(a in n)n[a]===!0&&(u&&(u.get&&u.get(a)?a=u.get(a):u.getOption&&u.getOption(a)&&(a=u.getOption(a).text)),r.push(a));return r.sort()},dhtmlXGridObject.prototype._build_m_order=function(){if(this._c_order){this._m_order=[];for(var e=0;e<this._c_order.length;e++)this._m_order[this._c_order[e]]=e}},dhtmlXGridObject.prototype.filterByAll=function(){var e=[],t=[];this._build_m_order();for(var n=0;n<this.filters.length;n++)if(!(r>=this._cCount)){var r=this._m_order?this._m_order[this.filters[n][1]]:this.filters[n][1];t.push(r);var i=this.filters[n][0]._filter?this.filters[n][0]._filter():this.filters[n][0].value,s;typeof i!="function"&&(s=this.combos[r]||(this._col_combos?this._col_combos[r]:!1))&&(s.values?(r=s.values._dhx_find(i),i=r==-1?i:s.keys[r]):s.getOptionByLabel&&(i=s.getOptionByLabel(i)?s.getOptionByLabel(i).value:i)),e.push(i)}this.callEvent("onFilterStart",[t,e])&&(this.filterBy(t,e),this._cssEven&&this._fixAlterCss(),this.callEvent("onFilterEnd",[this.filters]),this._f_rowsBuffer&&this.rowsBuffer.length==this._f_rowsBuffer.length)&&(this._f_rowsBuffer=null)},dhtmlXGridObject.prototype.makeFilter=function(e,t){this.filters||(this.filters=[]),typeof e!="object"&&(e=document.getElementById(e));if(e){var n=this;e.style.width||(e.style.width="90%");if(e.tagName=="SELECT")this.filters.push([e,t]),this._loadSelectOptins(e,t),e.onchange=function(){n.filterByAll()},_isIE&&(e.style.marginTop="1px"),this.attachEvent("onEditCell",function(n,r,i){return this._build_m_order(),n==2&&this.filters&&(this._m_order?i==this._m_order[t]:i==t)&&this._loadSelectOptins(e,t),!0});else if(e.tagName=="INPUT")this.filters.push([e,t]),e.old_value=e.value="",e.onkeydown=function(){this._timer&&window.clearTimeout(this._timer),this._timer=window.setTimeout(function(){e.value!=e.old_value&&(n.filterByAll(),e.old_value=e.value)},500)};else if(e.tagName=="DIV"&&e.className=="combo"){this.filters.push([e,t]),e.style.padding="0px",e.style.margin="0px",window.dhx_globalImgPath||(window.dhx_globalImgPath=this.imgURL);var r=new dhtmlXCombo(e,"_filter","90%");r.filterSelfA=r.filterSelf,r.filterSelf=function(){this.getSelectedIndex()==0&&this.setComboText(""),this.filterSelfA.apply(this,arguments),this.optionsArr[0].hide(!1)},r.enableFilteringMode(!0),e.combo=r,e.value="",this._loadComboOptins(e,t),r.attachEvent("onChange",function(){e.value=r.getSelectedValue(),e.value===null&&(e.value=""),n.filterByAll()})}e.parentNode&&(e.parentNode.className+=" filter"),this._filters_ready()}},dhtmlXGridObject.prototype.findCell=function(e,t,n,r){r=r||function(e,t){return t.toString().toLowerCase().indexOf(e)!=-1},r===!0&&(r=function(e,t){return t.toString().toLowerCase()==e});var i=[],e=e.toString().toLowerCase();typeof n!="number"&&(n=n?1:0);if(!this.rowsBuffer.length)return i;for(var s=t||0;s<this._cCount;s++){if(this._h2)this._h2.forEachChild(0,function(t){if(n&&i.length==n)return i;r(e,this._get_cell_value(t.buff,s))&&i.push([t.id,s])},this);else for(var o=0;o<this.rowsBuffer.length;o++)if(r(e,this._get_cell_value(this.rowsBuffer[o],s))&&(i.push([this.rowsBuffer[o].idd,s]),n&&i.length==n))return i;if(typeof t!="undefined")break}return i},dhtmlXGridObject.prototype.makeSearch=function(e,t,n){typeof e!="object"&&(e=document.getElementById(e));if(e){var r=this;e.tagName=="INPUT"&&(e.onkeypress=function(){this._timer&&window.clearTimeout(this._timer),this._timer=window.setTimeout(function(){if(e.value!=""){var i=r.findCell(e.value,t,!0,n);i.length&&(r._h2&&r.openItem(i[0][0]),r.selectCell(r.getRowIndex(i[0][0]),t||0))}},500)}),e.parentNode&&(e.parentNode.className+=" filter")}},dhtmlXGridObject.prototype._loadSelectOptins=function(e,t){var n=this.collectValues(t),r=e.value;e.innerHTML="",e.options[0]=new Option("","");for(var i=this._filter_tr?this._filter_tr[t]:null,s=0;s<n.length;s++)e.options[e.options.length]=new Option(i?i(n[s]):n[s],n[s]);e.value=r},dhtmlXGridObject.prototype.setSelectFilterLabel=function(e,t){this._filter_tr||(this._filter_tr=[]),this._filter_tr[e]=t},dhtmlXGridObject.prototype._loadComboOptins=function(e,t){if(e.combo){var n=this.collectValues(t);e.combo.clearAll(),e.combo.render(!1);for(var r=[["","&nbsp;"]],i=0;i<n.length;i++)r.push([n[i],n[i]]);e.combo.addOption(r),e.combo.render(!0)}},dhtmlXGridObject.prototype.refreshFilters=function(){if(this.filters)for(var e=0;e<this.filters.length;e++)switch(this.filters[e][0].tagName.toLowerCase()){case"select":this._loadSelectOptins.apply(this,this.filters[e]);break;case"div":this._loadComboOptins.apply(this,this.filters[e])}},dhtmlXGridObject.prototype._filters_ready=function(){this.attachEvent("onXLE",this.refreshFilters),this.attachEvent("onRowCreated",function(e,t){if(this._f_rowsBuffer)for(var n=0;n<this._f_rowsBuffer.length;n++)if(this._f_rowsBuffer[n].idd==e)return this._f_rowsBuffer[n]=t}),this.attachEvent("onClearAll",function(){this._f_rowsBuffer=null,this.hdr.rows.length||(this.filters=[])}),window.dhtmlXCombo&&this.attachEvent("onScroll",dhtmlXCombo.prototype.closeAll),this._filters_ready=function(){}},dhtmlXGridObject.prototype._in_header_text_filter=function(e,t){e.innerHTML="<input type='text'>",e.onclick=e.onmousedown=function(e){return(e||event).cancelBubble=!0},e.onselectstart=function(){return event.cancelBubble=!0},this.makeFilter(e.firstChild,t)},dhtmlXGridObject.prototype._in_header_text_filter_inc=function(e,t){e.innerHTML="<input type='text'>",e.onclick=e.onmousedown=function(e){return(e||event).cancelBubble=!0},e.onselectstart=function(){return event.cancelBubble=!0},this.makeFilter(e.firstChild,t),e.firstChild._filter=function(){return e.firstChild.value==""?"":function(t){return t.toString().toLowerCase().indexOf(e.firstChild.value.toLowerCase())==0}},this._filters_ready()},dhtmlXGridObject.prototype._in_header_select_filter=function(e,t){e.innerHTML="<select></select>",e.onclick=function(e){return(e||event).cancelBubble=!0,!1},this.makeFilter(e.firstChild,t)},dhtmlXGridObject.prototype._in_header_select_filter_strict=function(e,t){e.innerHTML="<select style='width:90%; font-size:8pt; font-family:Tahoma;'></select>",e.onclick=function(e){return(e||event).cancelBubble=!0,!1},this.makeFilter(e.firstChild,t);var n=this.combos;e.firstChild._filter=function(){var r=e.firstChild.value;return r?(n[t]&&(r=n[t].keys[n[t].values._dhx_find(r)]),r=r.toLowerCase(),function(e){return e.toString().toLowerCase()==r}):""},this._filters_ready()},dhtmlXGridObject.prototype._in_header_combo_filter=function(e,t){e.innerHTML="<div style='width:100%; padding-left:2px; overflow:hidden; ' class='combo'></div>",e.onselectstart=function(){return event.cancelBubble=!0},e.onclick=e.onmousedown=function(e){return(e||event).cancelBubble=!0},this.makeFilter(e.firstChild,t)},dhtmlXGridObject.prototype._search_common=function(e){e.innerHTML="<input type='text' style='width:90%; '>",e.onclick=e.onmousedown=function(e){return(e||event).cancelBubble=!0},e.onselectstart=function(){return event.cancelBubble=!0}},dhtmlXGridObject.prototype._in_header_text_search=function(e,t){this._search_common(e,t),this.makeSearch(e.firstChild,t)},dhtmlXGridObject.prototype._in_header_text_search_strict=function(e,t){this._search_common(e,t),this.makeSearch(e.firstChild,t,!0)},dhtmlXGridObject.prototype._in_header_numeric_filter=function(e,t){this._in_header_text_filter.call(this,e,t),e.firstChild._filter=function(){var e=this.value,t,n="==",r=parseFloat(e.replace("=","")),i=null;if(e){if(e.indexOf("..")!=-1)return e=e.split(".."),r=parseFloat(e[0]),i=parseFloat(e[1]),function(e){return e>=r&&e<=i?!0:!1};if(t=e.match(/>=|<=|>|</))n=t[0],r=parseFloat(e.replace(n,""));return Function("v"," if (v "+n+" "+r+" ) return true; return false;")}return""}},dhtmlXGridObject.prototype._in_header_master_checkbox=function(e,t,n){e.innerHTML=n[0]+"<input type='checkbox' />"+n[1];var r=this;e.getElementsByTagName("input")[0].onclick=function(e){r._build_m_order();var n=r._m_order?r._m_order[t]:t,i=this.checked?1:0;r.forEachRowA(function(e){var t=this.cells(e,n);t.isCheckbox()&&(t.setValue(i),t.cell.wasChanged=!0),this.callEvent("onEditCell",[1,e,n,i]),this.callEvent("onCheckbox",[e,n,i])}),(e||event).cancelBubble=!0}},dhtmlXGridObject.prototype._in_header_stat_total=function(e,t,n){var r=function(){var e=0;this._build_m_order();for(var n=this._m_order?this._m_order[t]:t,r=0;r<this.rowsBuffer.length;r++){var i=parseFloat(this._get_cell_value(this.rowsBuffer[r],n));e+=isNaN(i)?0:i}return this._maskArr[n]?this._aplNF(e,n):Math.round(e*100)/100};this._stat_in_header(e,r,t,n,n)},dhtmlXGridObject.prototype._in_header_stat_multi_total=function(e,t,n){var r=n[1].split(":");n[1]="";for(var i=0;i<r.length;i++)r[i]=parseInt(r[i]);for(var s=function(){for(var e=0,n=0;n<this.rowsBuffer.length;n++){for(var i=1,s=0;s<r.length;s++)i*=parseFloat(this._get_cell_value(this.rowsBuffer[n],r[s]));e+=isNaN(i)?0:i}return this._maskArr[t]?this._aplNF(e,t):Math.round(e*100)/100},o=[],t=0;t<r.length;t++)o[r[t]]=!0;this._stat_in_header(e,s,o,n,n)},dhtmlXGridObject.prototype._in_header_stat_max=function(e,t,n){var r=function(){var e=-999999999;if(this.getRowsNum()==0)return"&nbsp;";for(var n=0;n<this.rowsBuffer.length;n++)e=Math.max(e,parseFloat(this._get_cell_value(this.rowsBuffer[n],t)));return this._maskArr[t]?this._aplNF(e,t):e};this._stat_in_header(e,r,t,n)},dhtmlXGridObject.prototype._in_header_stat_min=function(e,t,n){var r=function(){var e=999999999;if(this.getRowsNum()==0)return"&nbsp;";for(var n=0;n<this.rowsBuffer.length;n++)e=Math.min(e,parseFloat(this._get_cell_value(this.rowsBuffer[n],t)));return this._maskArr[t]?this._aplNF(e,t):e};this._stat_in_header(e,r,t,n)},dhtmlXGridObject.prototype._in_header_stat_average=function(e,t,n){var r=function(){var e=0,n=0;if(this.getRowsNum()==0)return"&nbsp;";for(var r=0;r<this.rowsBuffer.length;r++){var i=parseFloat(this._get_cell_value(this.rowsBuffer[r],t));e+=isNaN(i)?0:i,n++}return this._maskArr[t]?this._aplNF(e/n,t):Math.round(e/n*100)/100};this._stat_in_header(e,r,t,n)},dhtmlXGridObject.prototype._in_header_stat_count=function(e,t,n){var r=function(){return this.getRowsNum()};this._stat_in_header(e,r,t,n)},dhtmlXGridObject.prototype._stat_in_header=function(e,t,n,r){var i=this,s=function(){this.dma(!0),e.innerHTML=(r[0]?r[0]:"")+t.call(this)+(r[1]?r[1]:""),this.dma(!1),this.callEvent("onStatReady",[])};this._stat_events||(this._stat_events=[],this.attachEvent("onClearAll",function(){if(!this.hdr.rows[1]){for(var e=0;e<this._stat_events.length;e++)for(var t=0;t<4;t++)this.detachEvent(this._stat_events[e][t]);this._stat_events=[]}})),this._stat_events.push([this.attachEvent("onGridReconstructed",s),this.attachEvent("onXLE",s),this.attachEvent("onFilterEnd",s),this.attachEvent("onEditCell",function(e,t,r){return e==2&&(r==n||n&&n[r])&&s.call(this),!0})]),e.innerHTML=""};