//v.3.5 build 120822
/*
Copyright DHTMLX LTD. http://www.dhtmlx.com
You allowed to use this component or parts of it under GPL terms
To use it on other terms or get Professional edition of the component please contact us at sales@dhtmlx.com
*/
dhtmlXGridObject.prototype.loadCSVFile=function(e,t){this.load(e,t,"csv")},dhtmlXGridObject.prototype.enableCSVAutoID=function(e){this._csvAID=convertStringToBoolean(e)},dhtmlXGridObject.prototype.enableCSVHeader=function(e){this._csvHdr=convertStringToBoolean(e)},dhtmlXGridObject.prototype.setCSVDelimiter=function(e){this.csv.cell=e},dhtmlXGridObject.prototype._csvAID=!0,dhtmlXGridObject.prototype.loadCSVString=function(e){this.parse(e,"csv")},dhtmlXGridObject.prototype.serializeToCSV=function(e){this.editStop(),this._agetm=this._mathSerialization?"getMathValue":this._strictText||e?"getTitle":"getValue";var t=[];if(this._csvHdr)for(var n=1;n<this.hdr.rows.length;n++){for(var r=[],i=0;i<this._cCount;i++)(!this._srClmn||this._srClmn[i])&&r.push(this.getColumnLabel(i,n-1));t.push(this.csvParser.str(r,this.csv.cell,this.csv.row))}for(var i=0,s=this.rowsBuffer.length;i<s;i++){var o=this._serializeRowToCVS(null,i);o!=""&&t.push(o)}return this.csvParser.block(t,this.csv.row)},dhtmlXGridObject.prototype._serializeRowToCVS=function(e,t,n,r){var i=[];e||(e=this.render_row(t),this._fake&&!this._fake.rowsAr[e.idd]&&this._fake.render_row(t)),this._csvAID||(i[i.length]=e.idd);for(var n=n||0,r=r||this._cCount,s=!1,o=n;e.childNodes[n]._cellIndex>o&&n;)n--;for(var u=n;o<r;u++){if(!e.childNodes[u])break;var a=e.childNodes[u]._cellIndex;if(!this._srClmn||this._srClmn[a]){for(var f=e.childNodes[u],l=this.cells(e.idd,a);o!=a;)if(o++,i.push(""),o>=r)break;if(o>=r)break;o++,zxVal=l.cell?l[this._agetm]():"",this._chAttr&&l.wasChanged()&&(s=!0),i[i.length]=zxVal===null?"":zxVal;if(this._ecspn&&f.colSpan&&f.colSpan>1)for(var f=f.colSpan-1,c=0;c<f;c++)i[i.length]="",o++}else o++}return this._onlChAttr&&!s?"":this.csvParser.str(i,this.csv.cell,this.csv.row)},dhtmlXGridObject.prototype.toClipBoard=function(e){window.clipboardData?window.clipboardData.setData("Text",e):(new Clipboard).copy(e)},dhtmlXGridObject.prototype.fromClipBoard=function(){return window.clipboardData?window.clipboardData.getData("Text"):(new Clipboard).paste()},dhtmlXGridObject.prototype.cellToClipboard=function(e,t){if(!e||!t){if(!this.selectedRows[0])return;e=this.selectedRows[0].idd,t=this.cell._cellIndex}var n=this.cells(e,t);this.toClipBoard(((n.getLabel?n.getLabel():n.getValue())||"").toString())},dhtmlXGridObject.prototype.updateCellFromClipboard=function(e,t){if(!e||!t){if(!this.selectedRows[0])return;e=this.selectedRows[0].idd,t=this.cell._cellIndex}var n=this.cells(e,t);n[n.setImage?"setLabel":"setValue"](this.fromClipBoard())},dhtmlXGridObject.prototype.rowToClipboard=function(e){var t="";this._agetm=this._mathSerialization?"getMathValue":this._strictText?"getTitle":"getValue";if(e)t=this._serializeRowToCVS(this.getRowById(e));else for(var n=[],r=0;r<this.selectedRows.length;r++)n[n.length]=this._serializeRowToCVS(this.selectedRows[r]),t=this.csvParser.block(n,this.csv.row);this.toClipBoard(t)},dhtmlXGridObject.prototype.updateRowFromClipboard=function(e){var t=this.fromClipBoard();if(t){var n=e?this.getRowById(e):this.selectedRows[0];if(n){var r=this.csvParser,t=r.unblock(t,this.csv.cell,this.csv.row)[0];this._csvAID||t.splice(0,1);for(var i=0;i<t.length;i++){var s=this.cells3(n,i);s[s.setImage?"setLabel":"setValue"](t[i])}}}},dhtmlXGridObject.prototype.csvParser={block:function(e,t){return e.join(t)},unblock:function(e,t,n){for(var r=(e||"").split(n),i=0;i<r.length;i++)r[i]=(r[i]||"").split(t);var s=r.length-1;return r[s].length==1&&r[s][0]==""&&r.splice(s,1),r},str:function(e,t){return e.join(t)}},dhtmlXGridObject.prototype.csvExtParser={_quote:RegExp('"',"g"),_quote_esc:RegExp('\\\\"',"g"),block:function(e,t){return e.join(t)},unblock:function(e,t,n){var r=[[]],i=0;if(!e)return r;for(var s=/^[ ]*"/,o=/"[ ]*$/,u=RegExp(".*"+n+".*$"),a=e.split(t),f=0;f<a.length;f++)if(a[f].match(s)){for(var l=a[f].replace(s,"");!a[f].match(o);)f++,l+=a[f];r[i].push(l.replace(o,"").replace(this._quote_esc,'"'))}else if(a[f].match(u)){var c=a[f].indexOf(n);r[i].push(a[f].substr(0,c)),i++,r[i]=[],a[f]=a[f].substr(c+1),f--}else(a[f]||f!=a.length-1)&&r[i].push(a[f]);var h=r.length-1;return h>0&&!r[h].length&&r.splice(h,1),r},str:function(e,t){for(var n=0;n<e.length;n++)e[n]='"'+e[n].replace(this._quote,'\\"')+'"';return e.join(t)}},dhtmlXGridObject.prototype.addRowFromClipboard=function(){var e=this.fromClipBoard();if(e)for(var t=this.csvParser.unblock(e,this.csv.cell,this.csv.row),n=0;n<t.length;n++)t[n]&&(e=t[n],e.length&&(this._csvAID?this.addRow(this.getRowsNum()+2,e):(this.rowsAr[e[0]]&&(e[0]=this.uid()),this.addRow(e[0],e.slice(1)))))},dhtmlXGridObject.prototype.gridToClipboard=function(){this.toClipBoard(this.serializeToCSV())},dhtmlXGridObject.prototype.gridFromClipboard=function(){var e=this.fromClipBoard();e&&this.loadCSVString(e)},dhtmlXGridObject.prototype.getXLS=function(e){if(!this.xslform){this.xslform=document.createElement("FORM"),this.xslform.action=(e||"")+"xls.php",this.xslform.method="post",this.xslform.target=_isIE?"_blank":"",document.body.appendChild(this.xslform);var t=document.createElement("INPUT");t.type="hidden",t.name="csv",this.xslform.appendChild(t);var n=document.createElement("INPUT");n.type="hidden",n.name="csv_header",this.xslform.appendChild(n)}var r=this.serializeToCSV();this.xslform.childNodes[0].value=r;for(var i=[],s=this._cCount,o=0;o<s;o++)i.push(this.getHeaderCol(o));i=i.join(","),this.xslform.childNodes[1].value=i,this.xslform.submit()},dhtmlXGridObject.prototype.printView=function(e,t){var n="<style>TD { font-family:Arial; text-align:center; padding-left:2px;padding-right:2px; } \n td.filter input, td.filter select { display:none; }	\n  </style>",r=null;if(this._fake)for(var r=[].concat(this._hrrar),i=0;i<this._fake._cCount;i++)this._hrrar[i]=null;n+="<base  href='"+document.location.href+"'></base>",this.parentGrid||(n+=e||""),n+='<table width="100%" border="2px" cellpadding="0" cellspacing="0">';var s=Math.max(this.rowsBuffer.length,this.rowsCol.length),o=this._cCount,u=this._printWidth();n+='<tr class="header_row_1">';for(i=0;i<o;i++)if(!this._hrrar||!this._hrrar[i]){for(var a=this.hdr.rows[1].cells[this.hdr.rows[1]._childIndexes?this.hdr.rows[1]._childIndexes[parseInt(i)]:i],f=a.colSpan||1,l=a.rowSpan||1,c=1;c<f;c++)u[i]+=u[c];n+='<td rowspan="'+l+'" width="'+u[i]+'%" style="background-color:lightgrey;" colspan="'+f+'">'+this.getHeaderCol(i)+"</td>",i+=f-1}n+="</tr>";for(i=2;i<this.hdr.rows.length;i++)if(_isIE){n+="<tr style='background-color:lightgrey' class='header_row_"+i+"'>";for(var h=this.hdr.rows[i].childNodes,c=0;c<h.length;c++)if(!this._hrrar||!this._hrrar[h[c]._cellIndex])n+=h[c].outerHTML;n+="</tr>"}else n+="<tr class='header_row_"+i+"' style='background-color:lightgrey'>"+(this._fake?this._fake.hdr.rows[i].innerHTML:"")+this.hdr.rows[i].innerHTML+"</tr>";for(i=0;i<s;i++)if(n+="<tr>",this.rowsCol[i]&&this.rowsCol[i]._cntr)n+=this.rowsCol[i].innerHTML.replace(/<img[^>]*>/gi,"")+"</tr>";else if(!this.rowsCol[i]||this.rowsCol[i].style.display!="none"){var p;if(this.rowsCol[i])p=this.rowsCol[i].idd;else{if(!this.rowsBuffer[i])continue;p=this.rowsBuffer[i].idd}for(c=0;c<o;c++)if(!this._hrrar||!this._hrrar[c]){if(this.rowsAr[p]&&this.rowsAr[p].tagName=="TR")var d=this.cells(p,c),v=d._setState?"":d.getContent?d.getContent():d.getImage||d.combo?d.cell.innerHTML:d.getValue();else v=this._get_cell_value(this.rowsBuffer[i],c);var m=this.columnColor[c]?"background-color:"+this.columnColor[c]+";":"",g=this.cellAlign[c]?"text-align:"+this.cellAlign[c]+";":"",y=d.getAttribute("colspan");n+='<td style="'+m+g+'" '+(y?'colSpan="'+y+'"':"")+">"+(v===""?"&nbsp;":v)+"</td>",y&&(c+=y-1)}n+="</tr>";if(this.rowsCol[i]&&this.rowsCol[i]._expanded){var b=this.cells4(this.rowsCol[i]._expanded.ctrl);n+=b.getSubGrid?'<tr><td colspan="'+o+'">'+b.getSubGrid().printView()+"</td></tr>":'<tr><td colspan="'+o+'">'+this.rowsCol[i]._expanded.innerHTML+"</td></tr>"}}if(this.ftr)for(i=1;i<this.ftr.childNodes[0].rows.length;i++)n+="<tr style='background-color:lightgrey'>"+(this._fake?this._fake.ftr.childNodes[0].rows[i].innerHTML:"")+this.ftr.childNodes[0].rows[i].innerHTML+"</tr>";n+="</table>";if(this.parentGrid)return n;n+=t||"";var w=window.open("","_blank");w.document.write(n),w.document.write("<script>window.onerror=function(){return true;}</script>"),w.document.close(),this._fake&&(this._hrrar=r)},dhtmlXGridObject.prototype._printWidth=function(){for(var e=[],t=0,n=0;n<this._cCount;n++){var r=this.getColWidth(n);e.push(r),t+=r}for(var i=[],s=0,n=0;n<e.length;n++){var o=Math.floor(e[n]/t*100);s+=o,i.push(o)}return i[i.length-1]+=100-s,i},dhtmlXGridObject.prototype.loadObject=function(){},dhtmlXGridObject.prototype.loadJSONFile=function(){},dhtmlXGridObject.prototype.serializeToObject=function(){},dhtmlXGridObject.prototype.serializeToJSON=function(){},window.clipboardData||(window.clipboardData={_make:function(){var e=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(!e)return null;var t=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!t)return null;t.addDataFlavor("text/unicode");var n=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);return this._p=[e,t,n],!0},setData:function(e,t){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(n){return dhtmlxError.throwError("Clipboard","Access to clipboard denied",[e,t]),""}if(!this._make())return!1;this._p[2].data=t,this._p[1].setTransferData("text/unicode",this._p[2],t.length*2);var r=Components.interfaces.nsIClipboard;this._p[0].setData(this._p[1],null,r.kGlobalClipboard)},getData:function(e){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(t){return dhtmlxError.throwError("Clipboard","Access to clipboard denied",[e]),""}if(!this._make())return!1;this._p[0].getData(this._p[1],this._p[0].kGlobalClipboard);var n={},r={};try{this._p[1].getTransferData("text/unicode",r,n)}catch(i){return""}return r&&(r=r.value.QueryInterface(Components.interfaces.nsISupportsString)),r?r.data.substring(0,n.value/2):""}});