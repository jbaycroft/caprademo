//v.3.5 build 120822
/*
Copyright DHTMLX LTD. http://www.dhtmlx.com
You allowed to use this component or parts of it under GPL terms
To use it on other terms or get Professional edition of the component please contact us at sales@dhtmlx.com
*/
function dhtmlxArray(e){return dhtmlXHeir(e||[],dhtmlxArray._master)}function dhtmlXGridObject(e){if(_isIE)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(t){}if(e)if(typeof e=="object"){if(this.entBox=e,!this.entBox.id)this.entBox.id="cgrid2_"+this.uid()}else this.entBox=document.getElementById(e);else this.entBox=document.createElement("DIV"),this.entBox.id="cgrid2_"+this.uid();this.entBox.innerHTML="",dhtmlxEventable(this);var n=this;this._wcorr=0,this.fontWidth=7,this.row=this.cell=null,this.iconURL="",this.editor=null,this._dclE=this._f2kE=!0,this.combos=[],this.defVal=[],this.rowsAr={},this.rowsBuffer=dhtmlxArray(),this.rowsCol=dhtmlxArray(),this._data_cache={},this._ecache={},this._ud_enabled=!0,this.xmlLoader=new dtmlXMLLoaderObject(this.doLoadDetails,this,!0,this.no_cashe),this._maskArr=[],this.selectedRows=dhtmlxArray(),this.UserData={},this._sizeFix=this._borderFix=0,this.entBox.className+=" gridbox",this.entBox.style.width=this.entBox.getAttribute("width")||(window.getComputedStyle?this.entBox.style.width||window.getComputedStyle(this.entBox,null).width:this.entBox.currentStyle?this.entBox.currentStyle.width:this.entBox.style.width||0)||"100%",this.entBox.style.height=this.entBox.getAttribute("height")||(window.getComputedStyle?this.entBox.style.height||window.getComputedStyle(this.entBox,null).height:this.entBox.currentStyle?this.entBox.currentStyle.height:this.entBox.style.height||0)||"100%",this.entBox.style.cursor="default",this.entBox.onselectstart=function(){return!1};var r=function(e){var t=document.createElement("TABLE");return t.cellSpacing=t.cellPadding=0,t.style.cssText="width:100%;table-layout:fixed;",t.className=e.substr(2),t};this.obj=r("c_obj"),this.hdr=r("c_hdr"),this.hdr.style.marginRight="20px",this.hdr.style.paddingRight="20px",this.objBox=document.createElement("DIV"),this.objBox.style.width="100%",this.objBox.style.overflow="auto",this.objBox.appendChild(this.obj),this.objBox.className="objbox",this.hdrBox=document.createElement("DIV"),this.hdrBox.style.width="100%",this.hdrBox.style.height="25px",this.hdrBox.style.overflow="hidden",this.hdrBox.className="xhdr",this.preloadImagesAr=[],this.sortImg=document.createElement("IMG"),this.sortImg.style.display="none",this.hdrBox.appendChild(this.sortImg),this.hdrBox.appendChild(this.hdr),this.hdrBox.style.position="relative",this.entBox.appendChild(this.hdrBox),this.entBox.appendChild(this.objBox),this.entBox.grid=this,this.objBox.grid=this,this.hdrBox.grid=this,this.obj.grid=this,this.hdr.grid=this,this.cellWidthPX=[],this.cellWidthPC=[],this.cellWidthType=this.entBox.cellwidthtype||"px",this.delim=this.entBox.delimiter||",",this._csvDelim=",",this.hdrLabels=[],this.columnIds=[],this.columnColor=[],this._hrrar=[],this.cellType=dhtmlxArray(),this.cellAlign=[],this.initCellWidth=[],this.fldSort=[],this._srdh=_isIE&&document.compatMode!="BackCompat"?22:20,this.imgURL=window.dhx_globalImgPath||"",this.isActive=!1,this.isEditable=!0,this.pagingOn=this.useImagesInHeader=!1,this.rowsBufferOutSize=0,dhtmlxEvent(window,"unload",function(){try{n.destructor&&n.destructor()}catch(e){}}),this.setSkin=function(e){this.skin_name=e;var t=this.entBox.className.split(" gridbox")[0];this.entBox.className=t+" gridbox gridbox_"+e,this.skin_h_correction=0,this.enableAlterCss("ev_"+e,"odd_"+e,this.isTreeGrid()),this._fixAlterCss();switch(e){case"clear":this._topMb=document.createElement("DIV"),this._topMb.className="topMumba",this._topMb.innerHTML="<img style='left:0px'   src='"+this.imgURL+"skinC_top_left.gif'><img style='right:20px' src='"+this.imgURL+"skinC_top_right.gif'>",this.entBox.appendChild(this._topMb),this._botMb=document.createElement("DIV"),this._botMb.className="bottomMumba",this._botMb.innerHTML="<img style='left:0px'   src='"+this.imgURL+"skinD_bottom_left.gif'><img style='right:20px' src='"+this.imgURL+"skinD_bottom_right.gif'>",this.entBox.appendChild(this._botMb),this.entBox.style.position!="absolute"&&(this.entBox.style.position="relative"),this.skin_h_correction=20;break;case"white":this._srdh=40,this.forceDivInHeader=!0;break;case"dhx_skyblue":case"dhx_web":case"glassy_blue":case"dhx_black":case"dhx_blue":case"modern":case"light":this._srdh=20,this.forceDivInHeader=!0;break;case"xp":this.forceDivInHeader=!0,this._srdh=_isIE&&document.compatMode!="BackCompat"?26:22;break;case"mt":this._srdh=_isIE&&document.compatMode!="BackCompat"?26:22;break;case"gray":_isIE&&document.compatMode!="BackCompat"&&(this._srdh=22)}if(_isIE&&this.hdr){var n=this.hdr.parentNode;n.removeChild(this.hdr),n.appendChild(this.hdr)}this.setSizes()},_isIE&&this.preventIECaching(!0),window.dhtmlDragAndDropObject&&(this.dragger=new dhtmlDragAndDropObject),this._doOnScroll=function(e,t){this.callEvent("onScroll",[this.objBox.scrollLeft,this.objBox.scrollTop]),this.doOnScroll(e,t)},this.doOnScroll=function(e,t){this.hdrBox.scrollLeft=this.objBox.scrollLeft,this.ftr&&(this.ftr.parentNode.scrollLeft=this.objBox.scrollLeft),!t&&this._srnd&&(this._dLoadTimer&&window.clearTimeout(this._dLoadTimer),this._dLoadTimer=window.setTimeout(function(){n._update_srnd_view&&n._update_srnd_view()},100))},this.attachToObject=function(e){e.appendChild(this.globalBox?this.globalBox:this.entBox),this.setSizes()},this.init=function(e){this.isTreeGrid()&&!this._h2&&(this._h2=new dhtmlxHierarchy,this._fake&&!this._realfake&&(this._fake._h2=this._h2),this._tgc={imgURL:null});if(this._hstyles){this.editStop(),this.fldSorted=this.r_fldSorted=this.resized=this.lastClicked=null,this.cellWidthPX=[],this.cellWidthPC=[],this.hdr.rows.length>0&&this.clearAll(!0);for(var t=this.hdr.insertRow(0),r=0;r<this.hdrLabels.length;r++)t.appendChild(document.createElement("TH")),t.childNodes[r]._cellIndex=r,t.childNodes[r].style.height="0px";_isIE&&_isIE<8?t.style.position="absolute":t.style.height="auto",t=this.hdr.insertRow(_isKHTML?2:1),t._childIndexes=[];for(var i=0,r=0;r<this.hdrLabels.length;r++)t._childIndexes[r]=r-i,this.hdrLabels[r]==this.splitSign&&r!=0?(_isKHTML&&t.insertCell(r-i),t.cells[r-i-1].colSpan=(t.cells[r-i-1].colSpan||1)+1,t.childNodes[r-i-1]._cellIndex++,i++,t._childIndexes[r]=r-i):(t.insertCell(r-i),t.childNodes[r-i]._cellIndex=r,t.childNodes[r-i]._cellIndexS=r,this.setColumnLabel(r,this.hdrLabels[r]));i==0&&(t._childIndexes=null),this._cCount=this.hdrLabels.length,_isIE&&window.setTimeout(function(){n.setSizes&&n.setSizes()},1),this.obj.firstChild||this.obj.appendChild(document.createElement("TBODY"));var s=this.obj.firstChild;if(!s.firstChild){s.appendChild(document.createElement("TR")),s=s.firstChild,_isIE&&_isIE<8?s.style.position="absolute":s.style.height="auto";for(r=0;r<this.hdrLabels.length;r++)s.appendChild(document.createElement("TH")),s.childNodes[r].style.height="0px"}this._c_order=null,this.multiLine!=1&&(this.obj.className+=" row20px"),this.sortImg.style.position="absolute",this.sortImg.style.display="none",this.sortImg.src=this.imgURL+"sort_desc.gif",this.sortImg.defLeft=0,this.noHeader?this.hdrBox.style.display="none":this.noHeader=!1,this.attachHeader(),this.attachHeader(0,0,"_aFoot"),this.setSizes(),e&&this.parseXML(),this.obj.scrollTop=0,this.dragAndDropOff&&this.dragger.addDragLanding(this.entBox,this),this._initDrF&&this._initD(),this._init_point&&this._init_point()}},this.setColumnSizes=function(e){for(var t=0,n=[],r=0,i=0;i<this._cCount;i++)if(this.initCellWidth[i]=="*"&&!this._hrrar[i])this._awdth=!1,n.push(i);else{if(this.cellWidthType=="%"){typeof this.cellWidthPC[i]=="undefined"&&(this.cellWidthPC[i]=this.initCellWidth[i]);var s=e*this.cellWidthPC[i]/100||0;r>.5&&(s++,r--);var o=this.cellWidthPX[i]=Math.floor(s),r=r+s-o}else typeof this.cellWidthPX[i]=="undefined"&&(this.cellWidthPX[i]=this.initCellWidth[i]);this._hrrar[i]||(t+=this.cellWidthPX[i]*1)}if(n.length){var u=Math.floor((e-t)/n.length);u<0&&(u=1);for(i=0;i<n.length;i++){var a=Math.max(this._drsclmW?this._drsclmW[n[i]]||0:0,u);this.cellWidthPX[n[i]]=a,t+=a}if(e>t){var f=n[n.length-1];this.cellWidthPX[f]+=e-t,t=e}this._setAutoResize()}return this.obj.style.width=t+"px",this.hdr.style.width=t+"px",this.ftr&&(this.ftr.style.width=t+"px"),this.chngCellWidth(),t},this.setSizes=function(){if(this.hdr.rows[0]){var e=this.quirks=_isIE&&document.compatMode=="BackCompat",t=(this.entBox.offsetWidth-this.entBox.clientWidth)/2;if(!this.dontSetSizes)if(this.globalBox){var r=(this.globalBox.offsetWidth-this.globalBox.clientWidth)/2;if(this._delta_x&&!this._realfake){var i=this.globalBox.clientWidth;this.globalBox.style.width=this._delta_x,this.entBox.style.width=Math.max(0,this.globalBox.clientWidth+(e?r*2:0)-this._fake.entBox.clientWidth)+"px",i!=this.globalBox.clientWidth&&this._fake._correctSplit(this._fake.entBox.clientWidth)}this._delta_y&&!this._realfake&&(this.globalBox.style.height=this._delta_y,this.entBox.style.overflow=this._fake.entBox.style.overflow="hidden",this.entBox.style.height=this._fake.entBox.style.height=this.globalBox.clientHeight+(e?r*2:0)+"px")}else this._delta_x&&(this.entBox.parentNode&&this.entBox.parentNode.tagName=="TD"?(this.entBox.style.width="1px",this.entBox.style.width=parseInt(this._delta_x)*this.entBox.parentNode.clientWidth/100-t*2+"px"):this.entBox.style.width=this._delta_x),this._delta_y&&(this.entBox.style.height=this._delta_y);window.clearTimeout(this._sizeTime);if(!this.entBox.offsetWidth&&(!this.globalBox||!this.globalBox.offsetWidth))this._sizeTime=window.setTimeout(function(){n.setSizes&&n.setSizes()},250);else{var s=!this._wthB&&(this.entBox.cmp||this._delta_x)&&(this.skin_name||"").indexOf("dhx")==0&&!e?2:0,o=!this._wthB&&(this.entBox.cmp||this._delta_y)&&(this.skin_name||"").indexOf("dhx")==0&&!e?2:0,u=this.parentGrid?!1:this.objBox.scrollHeight>this.objBox.offsetHeight,a=_isFF?18:18,f=this.entBox.clientWidth-(this.skin_h_correction||0)*(e?0:1)-s,l=this.entBox.clientWidth-(this.skin_h_correction||0)-s,h=this.entBox.clientHeight-o,p=this.setColumnSizes(l-(u?a:0)-(this._correction_x||0)),d=this.parentGrid?!1:this.objBox.scrollWidth>this.objBox.offsetWidth||this.objBox.style.overflowX=="scroll",v=this.hdr.clientHeight,m=this.ftr?this.ftr.clientHeight:0,g=f,y=h-v-m;this._awdth&&this._awdth[0]&&this._awdth[1]==99999&&(d=0),this._ahgr&&(y=this._ahgrMA?this.entBox.parentNode.clientHeight-v-m:this.obj.offsetHeight+(d?a:0)+(this._correction_y||0),this._ahgrM&&(y=this._ahgrF?Math.min(this._ahgrM,y+v+m)-v-m:Math.min(this._ahgrM,y)),u&&y>=this.obj.scrollHeight+(d?a:0))&&(u=!1,this.setColumnSizes(l-(this._correction_x||0))),this._awdth&&this._awdth[0]&&(this.cellWidthType=="%"&&(this.cellWidthType="px"),this._fake&&(p+=this._fake.entBox.clientWidth),g=Math.min(Math.max(p+(u?a:0),this._awdth[2]),this._awdth[1])+(this._correction_x||0),this._fake&&(g-=this._fake.entBox.clientWidth)),y=Math.max(0,y),this._ff_size_delta=this._ff_size_delta==.1?.2:.1,_isFF||(this._ff_size_delta=0),this.dontSetSizes||(this.entBox.style.width=Math.max(0,g+(e?2:0)*t+this._ff_size_delta)+"px",this.entBox.style.height=y+(e?2:0)*t+v+m+"px"),this.objBox.style.height=y+(e&&!u?2:0)*t+"px",this.hdrBox.style.height=v+"px",y!=h&&this.doOnScroll(0,!this._srnd);var b=this["setSizes_"+this.skin_name];b&&b.call(this),this.setSortImgPos(),v!=this.hdr.clientHeight&&this._ahgr&&this.setSizes(),this.callEvent("onSetSizes",[])}}},this.setSizes_clear=function(){var e=this.hdr.offsetHeight,t=this.entBox.offsetWidth,n=e+this.objBox.offsetHeight;this._topMb.style.top=(e||0)+"px",this._topMb.style.width=t+20+"px",this._botMb.style.top=n-3+"px",this._botMb.style.width=t+20+"px"},this.chngCellWidth=function(){_isOpera&&this.ftr&&(this.ftr.width=this.objBox.scrollWidth+"px");for(var e=this._cCount,t=0;t<e;t++)if(this.hdr.rows[0].cells[t].style.width=this.cellWidthPX[t]+"px",this.obj.rows[0].childNodes[t].style.width=this.cellWidthPX[t]+"px",this.ftr)this.ftr.rows[0].cells[t].style.width=this.cellWidthPX[t]+"px"},this.setDelimiter=function(e){this.delim=e},this.setInitWidthsP=function(e,t){this.cellWidthType="%",this.initCellWidth=e.split(this.delim.replace(/px/gi,"")),t||this._setAutoResize()},this._setAutoResize=function(){if(!this._realfake){var e=window,t=this;dhtmlxEvent(window,"resize",function(){window.clearTimeout(t._resize_timer),t._setAutoResize&&(t._resize_timer=window.setTimeout(function(){t.setSizes&&t.setSizes(),t._fake&&t._fake._correctSplit()},100))})}},this.setInitWidths=function(e){this.cellWidthType="px",this.initCellWidth=e.split(this.delim);if(_isFF)for(var t=0;t<this.initCellWidth.length;t++)this.initCellWidth[t]!="*"&&(this.initCellWidth[t]=parseInt(this.initCellWidth[t]))},this.enableMultiline=function(e){this.multiLine=convertStringToBoolean(e)},this.enableMultiselect=function(e){this.selMultiRows=convertStringToBoolean(e)},this.setImagesPath=this.setImagePath=function(e){this.imgURL=e},this.setIconsPath=this.setIconPath=function(e){this.iconURL=e},this.changeCursorState=function(e){var t=e.target||e.srcElement;t.tagName!="TD"&&(t=this.getFirstParentOfType(t,"TD"));if(t){if(t.tagName=="TD"&&this._drsclmn&&!this._drsclmn[t._cellIndex])return t.style.cursor="default";var n=(e.layerX||0)+(!_isIE&&e.target.tagName=="DIV"?t.offsetLeft:0);t.style.cursor=t.offsetWidth-(e.offsetX||(parseInt(this.getPosition(t,this.hdrBox))-n)*-1)<(_isOpera?20:10)?"E-resize":"default",_isOpera&&(this.hdrBox.scrollLeft=this.objBox.scrollLeft)}},this.startColResize=function(e){this.resized&&this.stopColResize(),this.resized=null;var t=e.target||e.srcElement;t.tagName!="TD"&&(t=this.getFirstParentOfType(t,"TD"));var r=e.clientX,i=this.hdr.offsetWidth,s=parseInt(t.offsetWidth);t.tagName=="TD"&&t.style.cursor!="default"&&(!this._drsclmn||this._drsclmn[t._cellIndex])&&(n._old_d_mm=document.body.onmousemove,n._old_d_mu=document.body.onmouseup,document.body.onmousemove=function(e){n&&n.doColResize(e||window.event,t,s,r,i)},document.body.onmouseup=function(){n&&n.stopColResize()})},this.stopColResize=function(){document.body.onmousemove=n._old_d_mm||"",document.body.onmouseup=n._old_d_mu||"",this.setSizes(),this.doOnScroll(0,1),this.callEvent("onResizeEnd",[this])},this.doColResize=function(e,t,n,r,i){t.style.cursor="E-resize",this.resized=t;var s=n+(e.clientX-r),o=i+(e.clientX-r);if(this.callEvent("onResize",[t._cellIndex,s,this])){_isIE&&(this.objBox.scrollLeft=this.hdrBox.scrollLeft);if(t.colSpan>1){for(var u=[],a=0;a<t.colSpan;a++)u[a]=Math.round(s*this.hdr.rows[0].childNodes[t._cellIndexS+a].offsetWidth/t.offsetWidth);for(a=0;a<t.colSpan;a++)this._setColumnSizeR(t._cellIndexS+a*1,u[a])}else this._setColumnSizeR(t._cellIndex,s);this.doOnScroll(0,1),this.setSizes(),this._fake&&this._awdth&&this._fake._correctSplit()}},this._setColumnSizeR=function(e,t){if(t>(this._drsclmW&&!this._notresize?this._drsclmW[e]||10:10)){this.obj.rows[0].childNodes[e].style.width=t+"px",this.hdr.rows[0].childNodes[e].style.width=t+"px",this.ftr&&(this.ftr.rows[0].childNodes[e].style.width=t+"px");if(this.cellWidthType=="px")this.cellWidthPX[e]=t;else{var n=parseInt(this.entBox.offsetWidth);this.objBox.scrollHeight>this.objBox.offsetHeight&&(n-=17);var r=Math.round(t/n*100);this.cellWidthPC[e]=r}this.sortImg.style.display!="none"&&this.setSortImgPos()}},this.setSortImgState=function(e,t,n,r){n=(n||"asc").toLowerCase();if(convertStringToBoolean(e)){this.sortImg.src=n=="asc"?this.imgURL+"sort_asc.gif":this.imgURL+"sort_desc.gif",this.sortImg.style.display="",this.fldSorted=this.hdr.rows[0].childNodes[t];var i=this.hdr.rows[r||1];if(i){for(var s=0;s<i.childNodes.length;s++)if(i.childNodes[s]._cellIndexS==t)return this.r_fldSorted=i.childNodes[s],this.setSortImgPos();return this.setSortImgState(e,t,n,(r||1)+1)}}else this.sortImg.style.display="none",this.fldSorted=this.r_fldSorted=null},this.setSortImgPos=function(e,t,n,r){if(!this._hrrar||!this._hrrar[this.r_fldSorted?this.r_fldSorted._cellIndex:e])if(r||(r=e?this.hdr.rows[n||0].cells[e]:this.r_fldSorted),r!=null){var i=this.getPosition(r,this.hdrBox),s=r.offsetWidth;this.sortImg.style.left=Number(i[0]+s-13)+"px",this.sortImg.defLeft=parseInt(this.sortImg.style.left),this.sortImg.style.top=Number(i[1]+5)+"px",!this.useImagesInHeader&&!t&&(this.sortImg.style.display="inline"),this.sortImg.style.left=this.sortImg.defLeft+"px"}},this.setActive=function(e){arguments.length==0&&(e=!0),e==1?(globalActiveDHTMLGridObject&&globalActiveDHTMLGridObject!=this&&(globalActiveDHTMLGridObject.editStop(),globalActiveDHTMLGridObject.callEvent("onBlur",[globalActiveDHTMLGridObject])),globalActiveDHTMLGridObject=this,this.isActive=!0):(this.isActive=!1,this.callEvent("onBlur",[this]))},this._doClick=function(e){var t=0,n=this.getFirstParentOfType(_isIE?e.srcElement:e.target,"TD");if(n){var r=!0;if(this.markedCells){var i=0;if(e.shiftKey||e.metaKey)i=1;return e.ctrlKey&&(i=2),this.doMark(n,i),!0}this.selMultiRows!=0&&(e.shiftKey&&this.row!=null&&this.selectedRows.length&&(t=1),e.ctrlKey||e.metaKey)&&(t=2),this.doClick(n,r,t)}},this._doContClick=function(e){var t=this.getFirstParentOfType(_isIE?e.srcElement:e.target,"TD");if(!t||typeof t.parentNode.idd=="undefined")return this.callEvent("onEmptyClick",[e]),!0;if(e.button==2||_isMacOS&&e.ctrlKey){if(!this.callEvent("onRightClick",[t.parentNode.idd,t._cellIndex,e])){var n=function(e){return(e||event).cancelBubble=!0,!1};return(e.srcElement||e.target).oncontextmenu=n,n(e)}if(this._ctmndx){if(!this.callEvent("onBeforeContextMenu",[t.parentNode.idd,t._cellIndex,this]))return!0;_isIE&&(e.srcElement.oncontextmenu=function(){return event.cancelBubble=!0,!1});if(this._ctmndx.showContextMenu){var r=window.document.documentElement,i=window.document.body,s=[r.scrollLeft||i.scrollLeft,r.scrollTop||i.scrollTop];if(_isIE)var o=e.clientX+s[0],u=e.clientY+s[1];else o=e.pageX,u=e.pageY;this._ctmndx.showContextMenu(o-1,u-1),this.contextID=this._ctmndx.contextMenuZoneId=t.parentNode.idd+"_"+t._cellIndex,this._ctmndx._skip_hide=!0}else t.contextMenuId=t.parentNode.idd+"_"+t._cellIndex,t.contextMenu=this._ctmndx,t.a=this._ctmndx._contextStart,t.a(t,e),t.a=null;return e.cancelBubble=!0,!1}}else this._ctmndx&&(this._ctmndx.hideContextMenu?this._ctmndx.hideContextMenu():this._ctmndx._contextEnd());return!0},this.doClick=function(e,t,r,i){this.selMultiRows||(r=0);var s=this.row?this.row.idd:0;this.setActive(!0),r||(r=0),this.cell!=null&&(this.cell.className=this.cell.className.replace(/cellselected/g,""));if(e.tagName=="TD"){if(this.checkEvent("onSelectStateChanged"))var o=this.getSelectedId();var u=this.row;if(r==1){var a=this.rowsCol._dhx_find(e.parentNode),f=this.rowsCol._dhx_find(this.lastClicked);if(a>f)var l=f,h=a;else l=a,h=f;for(var p=0;p<this.rowsCol.length;p++)if(p>=l&&p<=h){if(!this.rowsCol[p]||!!this.rowsCol[p]._sRow)return this.clearSelection(),this.doClick(e,t,0,i);this.rowsCol[p].className.indexOf("rowselected")==-1&&this.callEvent("onBeforeSelect",[this.rowsCol[p].idd,s])&&(this.rowsCol[p].className+=" rowselected",this.selectedRows[this.selectedRows.length]=this.rowsCol[p])}}else if(r==2&&e.parentNode.className.indexOf("rowselected")!=-1){e.parentNode.className=e.parentNode.className.replace(/rowselected/g,""),this.selectedRows._dhx_removeAt(this.selectedRows._dhx_find(e.parentNode));var d=!0,i=!1}this.editStop();if(typeof e.parentNode.idd=="undefined")return!0;if(!d&&!e.parentNode._sRow)if(this.callEvent("onBeforeSelect",[e.parentNode.idd,s]))if(this.getSelectedRowId()!=e.parentNode.idd){r==0&&this.clearSelection(),this.cell=e,u==e.parentNode&&this._chRRS&&(t=!1),this.row=e.parentNode,this.row.className+=" rowselected";if(this.cell&&_isIE&&_isIE==8){var v=this.cell.nextSibling,m=this.cell.parentNode;m.removeChild(this.cell),m.insertBefore(this.cell,v)}this.selectedRows._dhx_find(this.row)==-1&&(this.selectedRows[this.selectedRows.length]=this.row)}else this.cell=e,this.row=e.parentNode;else t=!1;this.cell&&this.cell.parentNode.className.indexOf("rowselected")!=-1&&(this.cell.className=this.cell.className.replace(/cellselected/g,"")+" cellselected");if(r!=1&&!this.row)return;this.lastClicked=e.parentNode;var g=this.row.idd,y=this.cell;t&&typeof g!="undefined"&&y&&!d?n.onRowSelectTime=setTimeout(function(){n.callEvent&&n.callEvent("onRowSelect",[g,y._cellIndex])},100):this.callEvent("onRowSelectRSOnly",[g]);if(this.checkEvent("onSelectStateChanged")){var b=this.getSelectedId();o!=b&&this.callEvent("onSelectStateChanged",[b,o])}}this.isActive=!0,i!==!1&&this.cell&&this.cell.parentNode.idd&&this.moveToVisible(this.cell)},this.selectAll=function(){this.clearSelection();var e=this.rowsBuffer;this.pagingOn&&(e=this.rowsCol);for(var t=0;t<e.length;t++)this.render_row(t).className+=" rowselected";this.selectedRows=dhtmlxArray([].concat(e)),this.selectedRows.length&&(this.row=this.selectedRows[0],this.cell=this.row.cells[0]),this._fake&&!this._realfake&&this._fake.selectAll()},this.selectCell=function(e,t,n,r,i,s){n||(n=!1),typeof e!="object"&&(e=this.render_row(e));if(!e||e==-1)return null;var o=e.childNodes[t];o||(o=e.childNodes[0]),this.markedCells?this.doMark(o,r?2:0):r?this.doClick(o,n,3,s):this.doClick(o,n,0,s),i&&this.editCell()},this.moveToVisible=function(e,t){if(this.pagingOn){var n=Math.floor(this.getRowIndex(e.parentNode.idd)/this.rowsBufferOutSize)+1;n!=this.currentPage&&this.changePage(n)}try{if(e.offsetHeight){var r=e.offsetLeft+e.offsetWidth+20,i=0;r>this.objBox.offsetWidth+this.objBox.scrollLeft?e.offsetLeft>this.objBox.scrollLeft&&(i=e.offsetLeft-5):e.offsetLeft<this.objBox.scrollLeft&&(r-=e.offsetWidth*2/3,r<this.objBox.scrollLeft&&(i=e.offsetLeft-5)),i&&!t&&(this.objBox.scrollLeft=i)}if(e.offsetHeight)r=e.offsetTop;else var s=this._realfake?this._fake.rowsAr[e.parentNode.idd]:e.parentNode,r=this.rowsBuffer._dhx_find(s)*this._srdh;var o=r+e.offsetHeight+38;if(o>this.objBox.offsetHeight+this.objBox.scrollTop)var u=o-this.objBox.offsetHeight;else r<this.objBox.scrollTop&&(u=r-5);u&&(this.objBox.scrollTop=u)}catch(a){}},this.editCell=function(){if(!this.editor||this.cell!=this.editor.cell){this.editStop();if(this.isEditable!=1||!this.cell)return!1;var e=this.cell;if(e.parentNode._locked)return!1;this.editor=this.cells4(e);if(this.editor!=null){if(this.editor.isDisabled())return this.editor=null,!1;this.callEvent("onEditCell",[0,this.row.idd,this.cell._cellIndex])!=0&&this.editor.edit?(this._Opera_stop=(new Date).valueOf(),e.className+=" editable",this.editor.edit(),this.callEvent("onEditCell",[1,this.row.idd,this.cell._cellIndex])):this.editor=null}}},this.editStop=function(e){if(_isOpera&&this._Opera_stop){if(this._Opera_stop*1+50>(new Date).valueOf())return;this._Opera_stop=null}if(this.editor&&this.editor!=null)if(this.editor.cell.className=this.editor.cell.className.replace("editable",""),e){var t=this.editor.val;this.editor.detach(),this.editor.setValue(t),this.editor=null,this.callEvent("onEditCancel",[this.row.idd,this.cell._cellIndex,t])}else{this.editor.detach()&&(this.cell.wasChanged=!0);var n=this.editor;this.editor=null;var r=this.callEvent("onEditCell",[2,this.row.idd,this.cell._cellIndex,n.getValue(),n.val]);typeof r=="string"||typeof r=="number"?n[n.setImage?"setLabel":"setValue"](r):r||n[n.setImage?"setLabel":"setValue"](n.val),this._ahgr&&this.multiLine&&this.setSizes()}},this._nextRowCell=function(e,t,n){return e=this._nextRow((this._groups?this.rowsCol:this.rowsBuffer)._dhx_find(e),t),e?e.childNodes[e._childIndexes?e._childIndexes[n]:n]:null},this._getNextCell=function(e,t,n){var e=e||this.cell,r=e.parentNode;return this._tabOrder?(n=this._tabOrder[e._cellIndex],typeof n!="undefined"&&(e=n<0?this._nextRowCell(r,t,Math.abs(n)-1):r.childNodes[n])):(n=e._cellIndex+t,n>=0&&n<this._cCount?(r._childIndexes&&(n=r._childIndexes[e._cellIndex]+t),e=r.childNodes[n]):e=this._nextRowCell(r,t,t==1?0:this._cCount-1)),e?e.style.display!="none"&&(!this.smartTabOrder||!this.cells(e.parentNode.idd,e._cellIndex).isDisabled())?e:this._getNextCell(e,t):(t==1&&this.tabEnd&&(this.tabEnd.focus(),this.tabEnd.focus(),this.setActive(!1)),t==-1&&this.tabStart&&(this.tabStart.focus(),this.tabStart.focus(),this.setActive(!1)),null)},this._nextRow=function(e,t){var n=this.render_row(e+t);return!n||n==-1?null:n&&n.style.display=="none"?this._nextRow(e+t,t):n},this.scrollPage=function(e){if(this.rowsBuffer.length){var t=this._realfake?this._fake:this,n=Math.floor((t._r_select||this.getRowIndex(this.row.idd)||0)+e*this.objBox.offsetHeight/(this._srdh||20));n<0&&(n=0),n>=this.rowsBuffer.length&&(n=this.rowsBuffer.length-1),this._srnd&&!this.rowsBuffer[n]?(this.objBox.scrollTop+=Math.floor(e*this.objBox.offsetHeight/(this._srdh||20))*(this._srdh||20),this._fake&&(this._fake.objBox.scrollTop=this.objBox.scrollTop),t._r_select=n):(this.selectCell(n,this.cell._cellIndex,!0,!1,!1,this.multiLine||this._srnd),!this.multiLine&&!this._srnd&&!this._realfake&&(this.objBox.scrollTop=this.getRowById(this.getRowId(n)).offsetTop,this._fake)&&(this._fake.objBox.scrollTop=this.objBox.scrollTop),t._r_select=null)}},this.doKey=function(e){if(!e)return!0;if((e.target||e.srcElement).value!==window.undefined){var t=e.target||e.srcElement;if(!t.parentNode||t.parentNode.className.indexOf("editable")==-1)return!0}if(globalActiveDHTMLGridObject&&this!=globalActiveDHTMLGridObject)return globalActiveDHTMLGridObject.doKey(e);if(this.isActive==0)return!0;if(this._htkebl)return!0;if(!this.callEvent("onKeyPress",[e.keyCode,e.ctrlKey,e.shiftKey,e]))return!1;var n="k"+e.keyCode+"_"+(e.ctrlKey?1:0)+"_"+(e.shiftKey?1:0);if(this.cell){if(this._key_events[n])return!1===this._key_events[n].call(this)?!0:(e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1);this._key_events.k_other&&this._key_events.k_other.call(this,e)}return!0},this.selectRow=function(e,t,n,r){typeof e!="object"&&(e=this.render_row(e)),this.selectCell(e,0,t,n,!1,r)},this.wasDblClicked=function(e){var t=this.getFirstParentOfType(_isIE?e.srcElement:e.target,"TD");if(t){var n=t.parentNode.idd;return this.callEvent("onRowDblClicked",[n,t._cellIndex])}},this._onHeaderClick=function(e,t){var n=this.grid,t=t||n.getFirstParentOfType(_isIE?event.srcElement:e.target,"TD");if(this.grid.resized==null){if(!this.grid.callEvent("onHeaderClick",[t._cellIndexS,e||window.event]))return!1;n.sortField(t._cellIndexS,!1,t)}this.grid.resized=null},this.deleteSelectedRows=function(){var e=this.selectedRows.length;if(e!=0){var t=this.selectedRows;this.selectedRows=dhtmlxArray();for(var n=e-1;n>=0;n--){var r=t[n];if(this.deleteRow(r.idd,r)){if(r==this.row)var i=n}else this.selectedRows[this.selectedRows.length]=r}if(i)try{i+1>this.rowsCol.length&&i--,this.selectCell(i,0,!0)}catch(s){this.cell=this.row=null}}},this.getSelectedRowId=function(){for(var e=[],t={},n=0;n<this.selectedRows.length;n++){var r=this.selectedRows[n].idd;t[r]||(e[e.length]=r,t[r]=!0)}return e.length==0?null:e.join(this.delim)},this.getSelectedCellIndex=function(){return this.cell!=null?this.cell._cellIndex:-1},this.getColWidth=function(e){return parseInt(this.cellWidthPX[e])},this.setColWidth=function(e,t){if(t=="*")this.initCellWidth[e]="*";else{if(this._hrrar[e])return;this.cellWidthType=="px"?this.cellWidthPX[e]=parseInt(t):this.cellWidthPC[e]=parseInt(t)}this.setSizes()},this.getRowIndex=function(e){for(var t=0;t<this.rowsBuffer.length;t++)if(this.rowsBuffer[t]&&this.rowsBuffer[t].idd==e)return t;return-1},this.getRowId=function(e){return this.rowsBuffer[e]?this.rowsBuffer[e].idd:this.undefined},this.setRowId=function(e,t){this.changeRowId(this.getRowId(e),t)},this.changeRowId=function(e,t){if(e!=t){var n=this.rowsAr[e];n.idd=t,this.UserData[e]&&(this.UserData[t]=this.UserData[e],this.UserData[e]=null),this._h2&&this._h2.get[e]&&(this._h2.get[t]=this._h2.get[e],this._h2.get[t].id=t,delete this._h2.get[e]),this.rowsAr[e]=null,this.rowsAr[t]=n;for(var r=0;r<n.childNodes.length;r++)n.childNodes[r]._code&&(n.childNodes[r]._code=this._compileSCL(n.childNodes[r]._val,n.childNodes[r]));if(this._mat_links&&this._mat_links[e]){var i=this._mat_links[e];delete this._mat_links[e];for(var s in i)for(r=0;r<i[s].length;r++)this._compileSCL(i[s][r].original,i[s][r])}this.callEvent("onRowIdChange",[e,t])}},this.setColumnIds=function(e){this.columnIds=e.split(this.delim)},this.setColumnId=function(e,t){this.columnIds[e]=t},this.getColIndexById=function(e){for(var t=0;t<this.columnIds.length;t++)if(this.columnIds[t]==e)return t},this.getColumnId=function(e){return this.columnIds[e]},this.getColLabel=this.getColumnLabel=function(e,t,n){for(var r=(n||this.hdr).rows[(t||0)+1],i=0;i<r.cells.length;i++)if(r.cells[i]._cellIndexS==e)return _isIE?r.cells[i].innerText:r.cells[i].textContent;return""},this.getFooterLabel=function(e,t){return this.getColumnLabel(e,t,this.ftr)},this.setRowTextBold=function(e){var t=this.getRowById(e);t&&(t.style.fontWeight="bold")},this.setRowTextStyle=function(e,t){var n=this.getRowById(e);if(n)for(var r=0;r<n.childNodes.length;r++){var i=n.childNodes[r]._attrs.style||"";n.childNodes[r].style.cssText=i+"width:"+n.childNodes[r].style.width+";"+t}},this.setRowColor=function(e,t){for(var n=this.getRowById(e),r=0;r<n.childNodes.length;r++)n.childNodes[r].bgColor=t},this.setCellTextStyle=function(e,t,n){var r=this.getRowById(e);if(r){var i=r.childNodes[r._childIndexes?r._childIndexes[t]:t];if(i){var s="";i.style.cssText=s+"width:"+i.style.width+";"+n}}},this.setRowTextNormal=function(e){var t=this.getRowById(e);t&&(t.style.fontWeight="normal")},this.doesRowExist=function(e){return this.getRowById(e)!=null?!0:!1},this.getColumnsNum=function(){return this._cCount},this.moveRowUp=function(e){var t=this.getRowById(e);if(this.isTreeGrid())return this.moveRowUDTG(e,-1);var n=this.rowsCol._dhx_find(t);if(t.previousSibling&&n!=0){t.parentNode.insertBefore(t,t.previousSibling),this.rowsCol._dhx_swapItems(n,n-1),this.setSizes();var r=this.rowsBuffer._dhx_find(t);this.rowsBuffer._dhx_swapItems(r,r-1),this._cssEven&&this._fixAlterCss(n-1)}},this.moveRowDown=function(e){var t=this.getRowById(e);if(this.isTreeGrid())return this.moveRowUDTG(e,1);var n=this.rowsCol._dhx_find(t);if(t.nextSibling){this.rowsCol._dhx_swapItems(n,n+1),t.nextSibling.nextSibling?t.parentNode.insertBefore(t,t.nextSibling.nextSibling):t.parentNode.appendChild(t),this.setSizes();var r=this.rowsBuffer._dhx_find(t);this.rowsBuffer._dhx_swapItems(r,r+1),this._cssEven&&this._fixAlterCss(n)}},this.getCombo=function(e){return this.combos[e]||(this.combos[e]=new dhtmlXGridComboObject),this.combos[e]},this.setUserData=function(e,t,n){e||(e="gridglobaluserdata"),this.UserData[e]||(this.UserData[e]=new Hashtable),this.UserData[e].put(t,n)},this.getUserData=function(e,t){e||(e="gridglobaluserdata"),this.getRowById(e);var n=this.UserData[e];return n?n.get(t):""},this.setEditable=function(e){this.isEditable=convertStringToBoolean(e)},this.selectRowById=function(e,t,n,r){r||(r=!1),this.selectCell(this.getRowById(e),0,r,t,!1,n)},this.clearSelection=function(){this.editStop();for(var e=0;e<this.selectedRows.length;e++){var t=this.rowsAr[this.selectedRows[e].idd];t&&(t.className=t.className.replace(/rowselected/g,""))}this.selectedRows=dhtmlxArray(),this.row=null,this.cell!=null&&(this.cell.className=this.cell.className.replace(/cellselected/g,""),this.cell=null),this.callEvent("onSelectionCleared",[])},this.copyRowContent=function(e,t){var n=this.getRowById(e);if(this.isTreeGrid())this._copyTreeGridRowContent(n,e,t);else for(var r=0;r<n.cells.length;r++)this.cells(t,r).setValue(this.cells(e,r).getValue());_isIE||(this.getRowById(e).cells[0].height=n.cells[0].offsetHeight)},this.setFooterLabel=function(e,t,n){return this.setColumnLabel(e,t,n,this.ftr)},this.setColumnLabel=function(e,t,n,r){var i=(r||this.hdr).rows[n||1],s=i._childIndexes?i._childIndexes[e]:e;if(i.cells[s]){if(this.useImagesInHeader){i.cells[s].style.textAlign="left",i.cells[s].innerHTML="<img src='"+this.imgURL+""+t+"' onerror='this.src = \""+this.imgURL+"imageloaderror.gif\"'>";var o=new Image;o.src=this.imgURL+""+t.replace(/(\.[a-z]+)/,".des$1"),this.preloadImagesAr[this.preloadImagesAr.length]=o;var u=new Image;u.src=this.imgURL+""+t.replace(/(\.[a-z]+)/,".asc$1"),this.preloadImagesAr[this.preloadImagesAr.length]=u}else{var a="<div class='hdrcell'>";if(t.indexOf("img:[")!=-1){var f=t.replace(/.*\[([^>]+)\].*/,"$1"),t=t.substr(t.indexOf("]")+1,t.length);a+="<img width='18px' height='18px' align='absmiddle' src='"+f+"' hspace='2'>"}a+=t,a+="</div>",i.cells[s].innerHTML=a,this._hstyles[s]&&(i.cells[s].style.cssText=this._hstyles[s])}if((t||"").indexOf("#")!=-1){var l=t.match(/(^|{)#([^}]+)(}|$)/);if(l){var c="_in_header_"+l[2];this[c]&&this[c](this.forceDivInHeader?i.cells[s].firstChild:i.cells[s],s,t.split(l[0]))}}}},this.setColLabel=function(e,t,n,r){return this.setColumnLabel(e,t,(n||0
)+1,r)},this.clearAll=function(e){if(this.obj.rows[0]){this._h2&&(this._h2=new dhtmlxHierarchy,this._fake)&&(this._realfake?this._h2=this._fake._h2:this._fake._h2=this._h2),this.limit=this._limitC=0,this.editStop(!0),this._dLoadTimer&&window.clearTimeout(this._dLoadTimer),this._dload&&(this.objBox.scrollTop=0,this.limit=this._limitC||0,this._initDrF=!0);for(var t=this.rowsCol.length,t=this.obj.rows.length,n=t-1;n>0;n--){var r=this.obj.rows[n];r.parentNode.removeChild(r)}if(e){this._master_row=null,this.obj.rows[0].parentNode.removeChild(this.obj.rows[0]);for(n=this.hdr.rows.length-1;n>=0;n--)r=this.hdr.rows[n],r.parentNode.removeChild(r);this.ftr&&(this.ftr.parentNode.removeChild(this.ftr),this.ftr=null),this._aHead=this.ftr=this.cellWidth=this._aFoot=null,this.cellType=dhtmlxArray(),this._hrrar=[],this.columnIds=[],this.combos=[],this._strangeParams=[],this.defVal=[],this._ivizcol=null}this.cell=this.row=null,this.rowsCol=dhtmlxArray(),this.rowsAr={},this._RaSeCol=[],this.rowsBuffer=dhtmlxArray(),this.UserData=[],this.selectedRows=dhtmlxArray();if(this.pagingOn||this._srnd)this.xmlFileUrl="";this.pagingOn&&this.changePage(1),this._contextCallTimer&&window.clearTimeout(this._contextCallTimer),this._sst&&this.enableStableSorting(!0),this._fillers=this.undefined,this.setSortImgState(!1),this.setSizes(),this.callEvent("onClearAll",[])}},this.sortField=function(e,t,n){if(this.getRowsNum()==0)return!1;var r=this.hdr.rows[0].cells[e];if(r&&r.tagName=="TH"&&this.fldSort.length-1>=r._cellIndex&&this.fldSort[r._cellIndex]!="na"){var i=this.getSortingState(),s=i[0]==e&&i[1]=="asc"?"des":"asc";if(this.callEvent("onBeforeSorting",[e,this.fldSort[e],s])){this.sortImg.src=this.imgURL+"sort_"+(s=="asc"?"asc":"desc")+".gif";if(this.useImagesInHeader){var o=this.hdr.rows[1].cells[r._cellIndex].firstChild;if(this.fldSorted!=null){var u=this.hdr.rows[1].cells[this.fldSorted._cellIndex].firstChild;u.src=u.src.replace(/(\.asc\.)|(\.des\.)/,".")}o.src=o.src.replace(/(\.[a-z]+)$/,"."+s+"$1")}this.sortRows(r._cellIndex,this.fldSort[r._cellIndex],s),this.fldSorted=r,this.r_fldSorted=n;var a=this.hdr.rows[1],a=n.parentNode,f=a._childIndexes?a._childIndexes[r._cellIndex]:r._cellIndex;this.setSortImgPos(!1,!1,!1,n)}}},this.enableHeaderImages=function(e){this.useImagesInHeader=e},this.setHeader=function(e,t,n){for(var r=typeof e!="object"?this._eSplit(e):[].concat(e),i=[],s=new dhtmlxArray(0),o=[],u=[],a=[],f=0;f<r.length;f++)i[i.length]=Math.round(100/r.length),s[s.length]="ed",o[o.length]="left",u[u.length]="middle",a[a.length]="na";this.splitSign=t||"#cspan",this.hdrLabels=r,this.cellWidth=i,this.initCellWidth.length||this.setInitWidthsP(i.join(this.delim),!0),this.cellType=s,this.cellAlign=o,this.cellVAlign=u,this.fldSort=a,this._hstyles=n||[]},this._eSplit=function(e){if(![].push)return e.split(this.delim);var t="r"+(new Date).valueOf(),n=this.delim.replace(/([\|\+\*\^])/g,"\\$1");return(e||"").replace(RegExp(n,"g"),t).replace(RegExp("\\\\"+t,"g"),this.delim).split(t)},this.getColType=function(e){return this.cellType[e]},this.getColTypeById=function(e){return this.cellType[this.getColIndexById(e)]},this.setColTypes=function(e){this.cellType=dhtmlxArray(e.split(this.delim)),this._strangeParams=[];for(var t=0;t<this.cellType.length;t++){if(this.cellType[t].indexOf("[")!=-1){var n=this.cellType[t].split(/[\[\]]+/g);this.cellType[t]=n[0],this.defVal[t]=n[1],n[1].indexOf("=")==0&&(this.cellType[t]="math",this._strangeParams[t]=n[0])}window["eXcell_"+this.cellType[t]]||dhtmlxError.throwError("Configuration","Incorrect cell type: "+this.cellType[t],[this,this.cellType[t]])}},this.setColSorting=function(e){this.fldSort=e.split(this.delim)},this.setColAlign=function(e){this.cellAlign=e.split(this.delim);for(var t=0;t<this.cellAlign.length;t++)this.cellAlign[t]=this.cellAlign[t]._dhx_trim()},this.setColVAlign=function(e){this.cellVAlign=e.split(this.delim)},this.setNoHeader=function(e){this.noHeader=convertStringToBoolean(e)},this.showRow=function(e){this.getRowById(e),this._h2&&this.openItem(this._h2.get[e].parent.id);for(var t=this.getRowById(e).childNodes[0];t&&t.style.display=="none";)t=t.nextSibling;t&&this.moveToVisible(t,!0)},this.setStyle=function(e,t,n,r){this.ssModifier=[e,t,n,n,r];for(var i=["#"+this.entBox.id+" table.hdr td","#"+this.entBox.id+" table.obj td","#"+this.entBox.id+" table.obj tr.rowselected td.cellselected","#"+this.entBox.id+" table.obj td.cellselected","#"+this.entBox.id+" table.obj tr.rowselected td"],s=0;!_isIE;){try{var o=document.styleSheets[s].cssRules.length}catch(u){s++;continue}break}for(var a=0;a<i.length;a++)this.ssModifier[a]&&(_isIE?document.styleSheets[0].addRule(i[a],this.ssModifier[a]):document.styleSheets[s].insertRule(i[a]+(" { "+this.ssModifier[a]+" }"),document.styleSheets[s].cssRules.length))},this.setColumnColor=function(e){this.columnColor=e.split(this.delim)},this.enableAlterCss=function(e,t,n,r){(e||t)&&this.attachEvent("onGridReconstructed",function(){this._fixAlterCss(),this._fake&&this._fake._fixAlterCss()}),this._cssSP=n,this._cssSU=r,this._cssEven=e,this._cssUnEven=t},this._fixAlterCss=function(e){if(this._h2&&(this._cssSP||this._cssSU))return this._fixAlterCssTGR(e);if(this._cssEven||this._cssUnEven)for(var t=e=e||0,n=e;n<this.rowsCol.length;n++)this.rowsCol[n]&&this.rowsCol[n].style.display!="none"&&(this.rowsCol[n]._cntr?t=1:(this.rowsCol[n].className=this.rowsCol[n].className.indexOf("rowselected")!=-1?t%2==1?this._cssUnEven+" rowselected "+(this.rowsCol[n]._css||""):this._cssEven+" rowselected "+(this.rowsCol[n]._css||""):t%2==1?this._cssUnEven+" "+(this.rowsCol[n]._css||""):this._cssEven+" "+(this.rowsCol[n]._css||""),t++))},this.getPosition=function(e,t){if(!t&&!_isChrome){var n=getOffset(e);return[n.left,n.top]}for(var t=t||document.body,r=e,i=0,s=0;r&&r!=t;)i+=r.offsetLeft-r.scrollLeft,s+=r.offsetTop-r.scrollTop,r=r.offsetParent;return t==document.body&&(_isIE?(s+=document.body.offsetTop||document.documentElement.offsetTop,i+=document.body.offsetLeft||document.documentElement.offsetLeft):_isFF||(i+=document.body.offsetLeft,s+=document.body.offsetTop)),[i,s]},this.getFirstParentOfType=function(e,t){for(;e&&e.tagName!=t&&e.tagName!="BODY";)e=e.parentNode;return e},this.objBox.onscroll=function(){this.grid._doOnScroll()},this.hdrBox.onscroll=function(){this._try_header_sync||(this._try_header_sync=!0,this.grid.objBox.scrollLeft!=this.scrollLeft&&(this.grid.objBox.scrollLeft=this.scrollLeft),this._try_header_sync=!1)};if(!_isOpera||_OperaRv>8.5)this.hdr.onmousemove=function(e){this.grid.changeCursorState(e||window.event)},this.hdr.onmousedown=function(e){return this.grid.startColResize(e||window.event)};return this.obj.onmousemove=this._drawTooltip,this.objBox.onclick=function(e){(e||event).cancelBubble=!0},this.obj.onclick=function(e){this.grid._doClick(e||window.event),this.grid._sclE?this.grid.editCell(e||window.event):this.grid.editStop(),(e||event).cancelBubble=!0},_isMacOS?this.entBox.oncontextmenu=function(e){return e.cancelBubble=!0,e.returnValue=!1,this.grid._doContClick(e||window.event)}:(this.entBox.onmousedown=function(e){return this.grid._doContClick(e||window.event)},this.entBox.oncontextmenu=function(e){return this.grid._ctmndx&&((e||event).cancelBubble=!0),!this.grid._ctmndx}),this.obj.ondblclick=function(e){if(!this.grid.wasDblClicked(e||window.event))return!1;if(this.grid._dclE){var t=this.grid.getFirstParentOfType(_isIE?event.srcElement:e.target,"TR");t==this.grid.row&&this.grid.editCell(e||window.event)}(e||event).cancelBubble=!0;if(_isOpera)return!1},this.hdr.onclick=this._onHeaderClick,this.sortImg.onclick=function(){n._onHeaderClick.apply({grid:n},[null,n.r_fldSorted])},this.hdr.ondblclick=this._onHeaderDblClick,document.body._dhtmlxgrid_onkeydown||(dhtmlxEvent(document,"keydown",function(e){if(globalActiveDHTMLGridObject)return globalActiveDHTMLGridObject.doKey(e||window.event)}),document.body._dhtmlxgrid_onkeydown=!0),dhtmlxEvent(document.body,"click",function(){n.editStop&&n.editStop(),n.isActive&&n.setActive(!1)}),this.entBox.onbeforeactivate=function(){this._still_active=null,this.grid.setActive(),event.cancelBubble=!0},this.entBox.onbeforedeactivate=function(){this.grid._still_active?this.grid._still_active=null:this.grid.isActive=!1,event.cancelBubble=!0},this.entBox.style.height.toString().indexOf("%")!=-1&&(this._delta_y=this.entBox.style.height),this.entBox.style.width.toString().indexOf("%")!=-1&&(this._delta_x=this.entBox.style.width),(this._delta_x||this._delta_y)&&this._setAutoResize(),this.setColHidden=this.setColumnsVisibility,this.enableCollSpan=this.enableColSpan,this.setMultiselect=this.enableMultiselect,this.setMultiLine=this.enableMultiline,this.deleteSelectedItem=this.deleteSelectedRows,this.getSelectedId=this.getSelectedRowId,this.getHeaderCol=this.getColumnLabel,this.isItemExists=this.doesRowExist,this.getColumnCount=this.getColumnsNum,this.setSelectedRow=this.selectRowById,this.setHeaderCol=this.setColumnLabel,this.preventIECashing=this.preventIECaching,this.enableAutoHeigth=this.enableAutoHeight,this.getUID=this.uid,dhtmlx.image_path&&this.setImagePath(dhtmlx.image_path),dhtmlx.skin&&this.setSkin(dhtmlx.skin),this}var globalActiveDHTMLGridObject;String.prototype._dhx_trim=function(){return this.replace(/&nbsp;/g," ").replace(/(^[ \t]*)|([ \t]*$)/g,"")},dhtmlxArray._master={_dhx_find:function(e){for(var t=0;t<this.length;t++)if(e==this[t])return t;return-1},_dhx_insertAt:function(e,t){this[this.length]=null;for(var n=this.length-1;n>=e;n--)this[n]=this[n-1];this[e]=t},_dhx_removeAt:function(e){this.splice(e,1)},_dhx_swapItems:function(e,t){var n=this[e];this[e]=this[t],this[t]=n}},dhtmlXGridObject.prototype={getRowAttribute:function(e,t){return this.getRowById(e)._attrs[t]},setRowAttribute:function(e,t,n){this.getRowById(e)._attrs[t]=n},isTreeGrid:function(){return this.cellType._dhx_find("tree")!=-1},setRowHidden:function(e,t){var n=convertStringToBoolean(t),r=this.getRowById(e);if(r){r.expand===""&&this.collapseKids(r);if(t&&r.style.display!="none"){r.style.display="none";var i=this.selectedRows._dhx_find(r);if(i!=-1){r.className=r.className.replace("rowselected","");for(var s=0;s<r.childNodes.length;s++)r.childNodes[s].className=r.childNodes[s].className.replace(/cellselected/g,"");this.selectedRows._dhx_removeAt(i)}this.callEvent("onGridReconstructed",[])}!t&&r.style.display=="none"&&(r.style.display="",this.callEvent("onGridReconstructed",[])),this.callEvent("onRowHide",[e,t]),this.setSizes()}},enableRowsHover:function(e,t){this._unsetRowHover(!1,!0),this._hvrCss=t,convertStringToBoolean(e)?this._elmnh||(this.obj._honmousemove=this.obj.onmousemove,this.obj.onmousemove=this._setRowHover,_isIE?this.obj.onmouseleave=this._unsetRowHover:this.obj.onmouseout=this._unsetRowHover,this._elmnh=!0):this._elmnh&&(this.obj.onmousemove=this.obj._honmousemove,_isIE?this.obj.onmouseleave=null:this.obj.onmouseout=null,this._elmnh=!1)},enableEditEvents:function(e,t,n){this._sclE=convertStringToBoolean(e),this._dclE=convertStringToBoolean(t),this._f2kE=convertStringToBoolean(n)},enableLightMouseNavigation:function(e){convertStringToBoolean(e)?this._elmn||(this.entBox._onclick=this.entBox.onclick,this.entBox.onclick=function(){return!0},this.obj._onclick=this.obj.onclick,this.obj.onclick=function(e){var t=this.grid.getFirstParentOfType(e?e.target:event.srcElement,"TD");t&&(this.grid.editStop(),this.grid.doClick(t),this.grid.editCell(),(e||event).cancelBubble=!0)},this.obj._onmousemove=this.obj.onmousemove,this.obj.onmousemove=this._autoMoveSelect,this._elmn=!0):this._elmn&&(this.entBox.onclick=this.entBox._onclick,this.obj.onclick=this.obj._onclick,this.obj.onmousemove=this.obj._onmousemove,this._elmn=!1)},_unsetRowHover:function(e,t){that=t?this:this.grid;if(that._lahRw&&that._lahRw!=t){for(var n=0;n<that._lahRw.childNodes.length;n++)that._lahRw.childNodes[n].className=that._lahRw.childNodes[n].className.replace(that._hvrCss,"");that._lahRw=null}},_setRowHover:function(e){var t=this.grid.getFirstParentOfType(e?e.target:event.srcElement,"TD");if(t&&t.parentNode!=this.grid._lahRw){this.grid._unsetRowHover(0,t),t=t.parentNode;if(!t.idd||t.idd=="__filler__")return;for(var n=0;n<t.childNodes.length;n++)t.childNodes[n].className+=" "+this.grid._hvrCss;this.grid._lahRw=t}this._honmousemove(e)},_autoMoveSelect:function(e){if(!this.grid.editor){var t=this.grid.getFirstParentOfType(e?e.target:event.srcElement,"TD");t.parentNode.idd&&this.grid.doClick(t,!0,0)}this._onmousemove(e)},destructor:function(){this.editStop(!0),this._sizeTime&&(this._sizeTime=window.clearTimeout(this._sizeTime)),this.entBox.className=(this.entBox.className||"").replace(/gridbox.*/,"");if(this.formInputs)for(var e=0;e<this.formInputs.length;e++)this.parentForm.removeChild(this.formInputs[e]);var t;this.xmlLoader=this.xmlLoader.destructor();for(e=0;e<this.rowsCol.length;e++)this.rowsCol[e]&&(this.rowsCol[e].grid=null);for(e in this.rowsAr)this.rowsAr[e]&&(this.rowsAr[e]=null);this.rowsCol=new dhtmlxArray,this.rowsAr={},this.entBox.innerHTML="";var n=function(){};this.setSizes=this._update_srnd_view=this.callEvent=this.entBox.onclick=this.entBox.onmousedown=this.entBox.onbeforeactivate=this.entBox.onbeforedeactivate=this.entBox.onbeforedeactivate=this.entBox.onselectstart=n,this.entBox.grid=this.objBox.grid=this.hdrBox.grid=this.obj.grid=this.hdr.grid=null,this._fake&&(this.globalBox.innerHTML="",this._fake.setSizes=this._fake._update_srnd_view=this._fake.callEvent=n,this.globalBox.onclick=this.globalBox.onmousedown=this.globalBox.onbeforeactivate=this.globalBox.onbeforedeactivate=this.globalBox.onbeforedeactivate=this.globalBox.onselectstart=n);for(t in this)this[t]&&this[t].m_obj&&(this[t].m_obj=null),this[t]=null;return this==globalActiveDHTMLGridObject&&(globalActiveDHTMLGridObject=null),null},getSortingState:function(){var e=[];return this.fldSorted&&(e[0]=this.fldSorted._cellIndex,e[1]=this.sortImg.src.indexOf("sort_desc.gif")!=-1?"des":"asc"),e},enableAutoHeight:function(e,t,n){this._ahgr=convertStringToBoolean(e),this._ahgrF=convertStringToBoolean(n),this._ahgrM=t||null,arguments.length==1&&(this.objBox.style.overflowY=e?"hidden":"auto"),t=="auto"&&(this._ahgrM=null,this._ahgrMA=!0,this._setAutoResize())},enableStableSorting:function(e){this._sst=convertStringToBoolean(e),this.rowsCol.stablesort=function(e){for(var t=this.length-1,n=0;n<this.length-1;n++){for(var r=0;r<t;r++)if(e(this[r],this[r+1])>0){var i=this[r];this[r]=this[r+1],this[r+1]=i}t--}}},enableKeyboardSupport:function(e){this._htkebl=!convertStringToBoolean(e)},enableContextMenu:function(e){this._ctmndx=e},setScrollbarWidthCorrection:function(){},enableTooltips:function(e){this._enbTts=e.split(",");for(var t=0;t<this._enbTts.length;t++)this._enbTts[t]=convertStringToBoolean(this._enbTts[t])},enableResizing:function(e){this._drsclmn=e.split(",");for(var t=0;t<this._drsclmn.length;t++)this._drsclmn[t]=convertStringToBoolean(this._drsclmn[t])},setColumnMinWidth:function(e,t){arguments.length==2?(this._drsclmW||(this._drsclmW=[]),this._drsclmW[t]=e):this._drsclmW=e.split(",")},enableCellIds:function(e){this._enbCid=convertStringToBoolean(e)},lockRow:function(e,t){var n=this.getRowById(e);n&&(n._locked=convertStringToBoolean(t),this.cell&&this.cell.parentNode.idd==e&&this.editStop())},_getRowArray:function(e){for(var t=[],n=0;n<e.childNodes.length;n++){var r=this.cells3(e,n);t[n]=r.getValue()}return t},_launchCommands:function(e){for(var t=0;t<e.length;t++){for(var n=[],r=0;r<e[t].childNodes.length;r++)e[t].childNodes[r].nodeType==1&&(n[n.length]=e[t].childNodes[r].firstChild.data);this[e[t].getAttribute("command")].apply(this,n)}},_parseHead:function(e){var t=this.xmlLoader.doXPath("./head",e);if(t.length){var n=this.xmlLoader.doXPath("./column",t[0]),r=this.xmlLoader.doXPath("./settings",t[0]),i="setInitWidths",s=!1;if(r[0])for(var o=0;o<r[0].childNodes.length;o++)switch(r[0].childNodes[o].tagName){case"colwidth":r[0].childNodes[o].firstChild&&r[0].childNodes[o].firstChild.data=="%"&&(i="setInitWidthsP");break;case"splitat":s=r[0].childNodes[o].firstChild?r[0].childNodes[o].firstChild.data:!1}this._launchCommands(this.xmlLoader.doXPath("./beforeInit/call",t[0]));if(n.length>0){this.hdr.rows.length>0&&this.clearAll(!0);for(var u=[[],[],[],[],[],[],[],[],[]],a=",width,type,align,sort,color,format,hidden,id".split(","),f=["",i,"setColTypes","setColAlign","setColSorting","setColumnColor","","","setColumnIds"],l=0;l<n.length;l++){for(var c=1;c<a.length;c++)u[c].push(n[l].getAttribute(a[c]));u[0].push((n[l].firstChild?n[l].firstChild.data:"").replace(/^\s*((\s\S)*.+)\s*$/gi,"$1"))}this.setHeader(u[0]);for(l=0;l<f.length;l++)f[l]&&this[f[l]](u[l].join(this.delim));for(l=0;l<n.length;l++)if(this.cellType[l].indexOf("co")==0||this.cellType[l]=="clist"){var h=this.xmlLoader.doXPath("./option",n[l]);if(h.length){var p=[];if(this.cellType[l]=="clist"){for(c=0;c<h.length;c++)p[p.length]=h[c].firstChild?h[c].firstChild.data:"";this.registerCList(l,p)}else for(var d=this.getCombo(l),c=0;c<h.length;c++)d.put(h[c].getAttribute("value"),h[c].firstChild?h[c].firstChild.data:"")}}else u[6][l]&&(this.cellType[l].toLowerCase().indexOf("calendar")!=-1||this.fldSort[l]=="date"?this.setDateFormat(u[6][l]):this.setNumberFormat(u[6][l],l));this.init();var v=u[7].join(this.delim);this.setColHidden&&v.replace(/,/g,"")!=""&&this.setColHidden(v),s&&this.splitAt&&this.splitAt(s)}this._launchCommands(this.xmlLoader.doXPath("./afterInit/call",t[0]))}var m=this.xmlLoader.doXPath("//rows/userdata",e);if(m.length>0){this.UserData.gridglobaluserdata||(this.UserData.gridglobaluserdata=new Hashtable);for(c=0;c<m.length;c++){for(var g="",y=0;y<m[c].childNodes.length;y++)g+=m[c].childNodes[y].nodeValue;this.UserData.gridglobaluserdata.put(m[c].getAttribute("name"),g)}}},getCheckedRows:function(e){var t=[];return this.forEachRowA(function(n){this.cells(n,e).getValue()!=0&&t.push(n)},!0),t.join(",")},checkAll:function(){for(var e=arguments.length?arguments[0]:1,t=0;t<this.getColumnsNum();t++)this.getColType(t)=="ch"&&this.setCheckedRows(t,e)},uncheckAll:function(){this.checkAll(0)},setCheckedRows:function(e,t){this.forEachRowA(function(n){this.cells(n,e).isCheckbox()&&this.cells(n,e).setValue(t)})},_drawTooltip:function(e){var t=this.grid.getFirstParentOfType(e?e.target:event.srcElement,"TD");if(!t||this.grid.editor&&this.grid.editor.cell==t)return!0;var n=t.parentNode;if(n.idd&&n.idd!="__filler__"){var r=e?e.target:event.srcElement;if(n.idd==window.unknown)return!0;if(!this.grid.callEvent("onMouseOver",[n.idd,t._cellIndex,e||window.event]))return!0;if(this.grid._enbTts&&!this.grid._enbTts[t._cellIndex])return r.title&&(r.title=""),!0;if(!(t._cellIndex>=this.grid._cCount)){var i=this.grid.cells3(n,t._cellIndex);if(i&&i.cell&&i.cell._attrs)return r._title&&(i.cell.title=""),i.cell._attrs.title||(r._title=!0),i&&(r.title=i.cell._attrs.title||(i.getTitle?i.getTitle():(i.getValue()||"").toString().replace(/<[^>]*>/gi,""))),!0}}},enableCellWidthCorrection:function(e){_isFF&&(this._wcorr=parseInt(e))},getAllRowIds:function(e){for(var t=[],n=0;n<this.rowsBuffer.length;n++)this.rowsBuffer[n]&&t.push(this.rowsBuffer[n].idd);return t.join(e||this.delim)},getAllItemIds:function(){return this.getAllRowIds()},preventIECaching:function(e){this.no_cashe=convertStringToBoolean(e),this.xmlLoader.rSeed=this.no_cashe},enableColumnAutoSize:function(e){this._eCAS=convertStringToBoolean(e)},_onHeaderDblClick:function(e){var t=this.grid,n=t.getFirstParentOfType(_isIE?event.srcElement:e.target,"TD");if(!t._eCAS)return!1;t.adjustColumnSize(n._cellIndexS)},adjustColumnSize:function(e,t){if(!this._hrrar||!this._hrrar[e]){this._notresize=!0;var n=0;this._setColumnSizeR(e,20);for(var r=1;r<this.hdr.rows.length;r++){var i=this.hdr.rows[r];(i=i.childNodes[i._childIndexes?i._childIndexes[e]:e])&&(!i.colSpan||i.colSpan<2)&&i._cellIndex==e&&(i.childNodes[0]&&i.childNodes[0].className=="hdrcell"&&(i=i.childNodes[0]),n=Math.max(n,_isFF||_isOpera?i.textContent.length*this.fontWidth:i.scrollWidth))}for(var s=this.obj.rows.length,o=1;o<s;o++){var u=this.obj.rows[o];this.rowsAr[u.idd]&&(!u._childIndexes||u._childIndexes[e]==e)&&u.childNodes[e]&&(u=_isFF||_isOpera||t?u.childNodes[e].textContent.length*this.fontWidth:u.childNodes[e].scrollWidth,u>n&&(n=u))}n+=20+(t||0),this._setColumnSizeR(e,n),this._notresize=!1,this.setSizes()}},detachHeader:function(e,t){var t=t||this.hdr,n=t.rows[e+1];n&&n.parentNode.removeChild(n),this.setSizes()},detachFooter:function(e){this.detachHeader(e,this.ftr)},attachHeader:function(e,t,n){typeof e=="string"&&(e=this._eSplit(e)),typeof t=="string"&&(t=t.split(this.delim)),n=n||"_aHead";if(this.hdr.rows.length){if(e)this._createHRow([e,t],this[n=="_aHead"?"hdr":"ftr"]);else if(this[n])for(var r=0;r<this[n].length;r++)this.attachHeader.apply(this,this[n][r])}else this[n]||(this[n]=[]),this[n][this[n].length]=[e,t,n]},_createHRow:function(e,t){if(!t){this.entBox.style.position!="absolute"&&(this.entBox.style.position="relative");var n=document.createElement("DIV");n.className="ftr",this.entBox.appendChild(n);var r=document.createElement("TABLE");r.cellPadding=r.cellSpacing=0;if(!_isIE||_isIE==8)r.width="100%",r.style.paddingRight="20px";r.style.marginRight="20px",r.style.tableLayout="fixed",n.appendChild(r),r.appendChild(document.createElement("TBODY")),this.ftr=t=r;for(var i=r.insertRow(0),s=this.hdrLabels.length<=1?e[0].length:this.hdrLabels.length,o=0;o<s;o++)i.appendChild(document.createElement("TH")),i.childNodes[o]._cellIndex=o;_isIE&&_isIE<8?i.style.position="absolute":i.style.height="auto"}var u=e[1],n=document.createElement("TR");t.rows[0].parentNode.appendChild(n);for(o=0;o<e[0].length;o++)if(e[0][o]=="#cspan"){var a=n.cells[n.cells.length-1];a.colSpan=(a.colSpan||1)+1}else if(e[0][o]=="#rspan"&&t.rows.length>1){for(var f=t.rows.length-2,l=!1,a=null;!l;){for(var a=t.rows[f],c=0;c<a.cells.length;c++)if(a.cells[c]._cellIndex==o){l=c+1;break}f--}a=a.cells[l-1],a.rowSpan=(a.rowSpan||1)+1}else{var h=document.createElement("TD");h._cellIndex=h._cellIndexS=o,this._hrrar&&this._hrrar[o]&&!_isIE&&(h.style.display="none");if(typeof e[0][o]=="object")h.appendChild(e[0][o]);else if(h.innerHTML=this.forceDivInHeader?"<div class='hdrcell'>"+(e[0][o]||"&nbsp;")+"</div>":e[0][o]||"&nbsp;",(e[0][o]||"").indexOf("#")!=-1)if(r=e[0][o].match(/(^|{)#([^}]+)(}|$)/)){var p="_in_header_"+r[2];this[p]&&this[p](this.forceDivInHeader?h.firstChild:h,o,e[0][o].split(r[0]))}u&&(h.style.cssText=u[o]),n.appendChild(h)}var d=t;_isKHTML&&(t._kTimer&&window.clearTimeout(t._kTimer),t._kTimer=window.setTimeout(function(){t.rows[1].style.display="none",window.setTimeout(function(){t.rows[1].style.display=""},1)},500))},forEachRow:function(e){for(var t in this.rowsAr)this.rowsAr[t]&&this.rowsAr[t].idd&&e.apply(this,[this.rowsAr[t].idd])},forEachRowA:function(e){for(var t=0;t<this.rowsBuffer.length;t++)this.rowsBuffer[t]&&e.call(this,this.render_row(t).idd)},forEachCell:function(e,t){var n=this.getRowById(e);if(n)for(var r=0;r<this._cCount;r++)t(this.cells3(n,r),r)},enableAutoWidth:function(e,t,n){this._awdth=[convertStringToBoolean(e),parseInt(t||99999),parseInt(n||0)],arguments.length==1&&(this.objBox.style.overflowX=e?"hidden":"auto")},updateFromXML:function(e,t,n,r){typeof t=="undefined"&&(t=!0),this._refresh_mode=[!0,t,n],this.load(e,r)},_refreshFromXML:function(e){this._f_rowsBuffer&&this.filterBy(0,""),reset=!1,window.eXcell_tree&&(eXcell_tree.prototype.setValueX=eXcell_tree.prototype.setValue,eXcell_tree.prototype.setValue=function(e){var t=this.grid._h2.get[this.cell.parentNode.idd];t&&this.cell.parentNode.valTag?this.setLabel(e):this.setValueX(e)});var t=this.cellType._dhx_find("tree");e.getXMLTopNode("rows");var n=e.doXPath("//rows")[0].getAttribute("parent")||0,r={};this._refresh_mode[2]&&(t!=-1?this._h2.forEachChild(n,function(e){r[e.id]=!0},this):this.forEachRow(function(e){r[e]=!0}));for(var i=e.doXPath("//row"),s=0;s<i.length;s++){var o=i[s],u=o.getAttribute("id");r[u]=!1,n=o.parentNode.getAttribute("id")||n;if(this.rowsAr[u]&&this.rowsAr[u].tagName!="TR")this._h2?this._h2.get[u].buff.data=o:this.rowsBuffer[this.getRowIndex(u)].data=o,this.rowsAr[u]=o;else if(this.rowsAr[u])this._process_xml_row(this.rowsAr[u],o,-1),this._postRowProcessing(this.rowsAr[u],!0);else if(this._refresh_mode[1]){var a={idd:u,data:o,_parser:this._process_xml_row,_locator:this._get_xml_data},f=this.rowsBuffer.length;this._refresh_mode[1]=="top"?(this.rowsBuffer.unshift(a),f=0):this.rowsBuffer.push(a),this._h2&&(reset=!0,this._h2.add(u,o.parentNode.getAttribute("id")||o.parentNode.getAttribute("parent")).buff=this.rowsBuffer[this.rowsBuffer.length-1]),this.rowsAr[u]=o,o=this.render_row(f),this._insertRowAt(o,f?-1:0)}}if(this._refresh_mode[2])for(u in r)r[u]&&this.rowsAr[u]&&this.deleteRow(u);this._refresh_mode=null,window.eXcell_tree&&(eXcell_tree.prototype.setValue=eXcell_tree.prototype.setValueX),reset&&this._renderSort(),this._f_rowsBuffer&&(this._f_rowsBuffer=null,this.filterByAll())},getCustomCombo:function(e,t){var n=this.cells(e,t).cell;return n._combo||(n._combo=new dhtmlXGridComboObject),n._combo},setTabOrder:function(e){var t=e.split(this.delim);this._tabOrder=[];for(var n=this._cCount||e.length,r=0;r<n;r++)t[r]={c:parseInt(t[r]),ind:r};t.sort(function(e,t){return e.c>t.c?1:-1});for(r=0;r<n;r++)this._tabOrder[t[r].ind]=!t[r+1]||typeof t[r].c=="undefined"?(t[0].ind+1)*-1:t[r+1].ind},i18n:{loading:"Loading",decimal_separator:".",group_separator:","},_key_events:{k13_1_0:function(){var e=this.rowsCol._dhx_find(this.row);this.selectCell(this.rowsCol[e+1],this.cell._cellIndex,!0)},k13_0_1:function(){var e=this.rowsCol._dhx_find(this.row);this.selectCell(this.rowsCol[e-1],this.cell._cellIndex,!0)},k13_0_0:function(){this.editStop(),this.callEvent("onEnter",[this.row?this.row.idd:null,this.cell?this.cell._cellIndex:null]),this._still_active=!0},k9_0_0:function(){this.editStop();if(!this.callEvent("onTab",[!0]))return!0;var e=this._getNextCell(null,1);e&&(this.selectCell(e.parentNode,e._cellIndex,this.row!=e.parentNode,!1,!0),this._still_active=!0)},k9_0_1:function(){this.editStop();if(!this.callEvent("onTab",[!1]))return!1;var e=this._getNextCell(null,-1);e&&(this.selectCell(e.parentNode,e._cellIndex,this.row!=e.parentNode,!1,!0),this._still_active=!0)},k113_0_0:function(){this._f2kE&&this.editCell()},k32_0_0:function(){var e=this.cells4(this.cell);if(!e.changeState||e.changeState()===!1)return!1},k27_0_0:function(){this.editStop(!0)},k33_0_0:function(){this.pagingOn?this.changePage(this.currentPage-1):this.scrollPage(-1)},k34_0_0:function(){this.pagingOn?this.changePage(this.currentPage+1):this.scrollPage(1)},k37_0_0:function(){if(!!this.editor||!this.isTreeGrid())return!1;this.collapseKids(this.row)},k39_0_0:function(){if(!!this.editor||!this.isTreeGrid())return!1;this.expandKids(this.row)},k40_0_0:function(){var e=this._realfake?this._fake:this;if(this.editor&&this.editor.combo)this.editor.shiftNext();else{if(!this.row.idd)return;var t=Math.max(e._r_select||0,this.getRowIndex(this.row.idd))+1;if(this.rowsBuffer[t])e._r_select=null,this.selectCell(t,this.cell._cellIndex,!0),e.pagingOn&&e.showRow(e.getRowId(t));else{if(!this.callEvent("onLastRow",[]))return!1;this._key_events.k34_0_0.apply(this,[]),this.pagingOn&&this.rowsCol[t]&&this.selectCell(t,0,!0)}}this._still_active=!0},k38_0_0:function(){var e=this._realfake?this._fake:this;if(this.editor&&this.editor.combo)this.editor.shiftPrev();else{if(!this.row.idd)return;var t=this.getRowIndex(this.row.idd)+1;if(t==-1||!!this.pagingOn&&t==1)this._key_events.k33_0_0.apply(this,[]);else{var n=this._nextRow(t-1,-1);this.selectCell(n,this.cell._cellIndex,!0),e.pagingOn&&n&&e.showRow(n.idd)}}this._still_active=!0}},_build_master_row:function(){for(var e=document.createElement("DIV"),t=["<table><tr>"],n=0;n<this._cCount;n++)t.push("<td></td>");t.push("</tr></table>"),e.innerHTML=t.join(""),this._master_row=e.firstChild.rows[0]},_prepareRow:function(e){this._master_row||this._build_master_row();for(var t=this._master_row.cloneNode(!0),n=0;n<t.childNodes.length;n++)t.childNodes[n]._cellIndex=n,this._enbCid&&(t.childNodes[n].id="c_"+e+"_"+n),this.dragAndDropOff&&this.dragger.addDraggableItem(t.childNodes[n],this);return t.idd=e,t.grid=this,t},_process_jsarray_row:function(e,t){e._attrs={};for(var n=0;n<e.childNodes.length;n++)e.childNodes[n]._attrs={};return this._fillRow(e,this._c_order?this._swapColumns(t):t),e},_get_jsarray_data:function(e,t){return e[t]},_process_json_row:function(e,t){return t=this._c_order?this._swapColumns(t.data):t.data,this._process_some_row(e,t)},_process_some_row:function(e,t){e._attrs={};for(var n=0;n<e.childNodes.length;n++)e.childNodes[n]._attrs={};return this._fillRow(e,t),e},_get_json_data:function(e,t){return e.data[t]},_process_js_row:function(e,t){for(var n=[],r=0;r<this.columnIds.length;r++)n[r]=t[this.columnIds[r]],!n[r]&&n[r]!==0&&(n[r]="");return this._process_some_row(e,n),e._attrs=t,e},_get_js_data:function(e,t){return e[this.columnIds[t]]},_process_csv_row:function(e,t){e._attrs={};for(var n=0;n<e.childNodes.length;n++)e.childNodes[n]._attrs={};return this._fillRow(e,this._c_order?this._swapColumns(t.split(this.csv.cell)):t.split(this.csv.cell)),e},_get_csv_data:function(e,t){return e.split(this.csv.cell)[t]},_process_store_row:function(e,t){for(var n=[],r=0;r<this.columnIds.length;r++)n[r]=t[this.columnIds[r]];for(var i=0;i<e.childNodes.length;i++)e.childNodes[i]._attrs={};e._attrs=t,this._fillRow(e,n)},_process_xml_row:function(e,t){var n=this.xmlLoader.doXPath(this.xml.cell,t),r=[];e._attrs=this._xml_attrs(t);if(this._ud_enabled)for(var i=this.xmlLoader.doXPath("./userdata",t),s=i.length-1;s>=0;s--){for(var o="",u=0;u<i[s].childNodes.length;u++)o+=i[s].childNodes[u].nodeValue;this.setUserData(e.idd,i[s].getAttribute("name"),o)}for(u=0;u<n.length;u++){var a=n[this._c_order?this._c_order[u]:u];if(a){var f=e._childIndexes?e._childIndexes[u]:u,l=a.getAttribute("type");e.childNodes[f]&&(l&&(e.childNodes[f]._cellType=l),e.childNodes[f]._attrs=this._xml_attrs(a)),a.getAttribute("xmlcontent")||(a=a.firstChild?a.firstChild.data:""),r.push(a)}}for(;u<e.childNodes.length;u++)e.childNodes[u]._attrs={};return e.parentNode&&e.parentNode.tagName=="row"&&(e._attrs.parent=e.parentNode.getAttribute("idd")),this._fillRow(e,r),e},_get_xml_data:function(e,t){for(e=e.firstChild;;){if(!e)return"";e.tagName=="cell"&&t--;if(t<0)break;e=e.nextSibling}return e.firstChild?e.firstChild.data:""},_fillRow:function(e,t){this.editor&&this.editStop();for(var n=0;n<e.childNodes.length;n++)if(n<t.length||this.defVal[n]){var r=e.childNodes[n]._cellIndex,i=t[r],s=this.cells4(e.childNodes[n]);this.defVal[r]&&(i==""||typeof i=="undefined")&&(i=this.defVal[r]),s&&s.setValue(i)}else e.childNodes[n].innerHTML="&nbsp;",e.childNodes[n]._clearCell=!0;return e},_postRowProcessing:function(e,t){e._attrs["class"]&&(e._css=e.className=e._attrs["class"]),e._attrs.locked&&(e._locked=!0),e._attrs.bgColor&&(e.bgColor=e._attrs.bgColor);for(var n=0,r=0;r<e.childNodes.length;r++){var i=e.childNodes[r],s=i._cellIndex,o=i._attrs.style||e._attrs.style;o&&(i.style.cssText+=";"+o),i._attrs["class"]&&(i.className=i._attrs["class"]);if(o=i._attrs.align||this.cellAlign[s])i.align=o;i.vAlign=i._attrs.valign||this.cellVAlign[s];var u=i._attrs.bgColor||this.columnColor[s];u&&(i.bgColor=u),i._attrs.colspan&&!t&&(this.setColspan(e.idd,r+n,i._attrs.colspan),n+=i._attrs.colspan-1),this._hrrar&&this._hrrar[s]&&!t&&(i.style.display="none")}this.callEvent("onRowCreated",[e.idd,e,null])},load:function(e,t,n){this.callEvent("onXLS",[this]),arguments.length==2&&typeof t!="function"&&(n=t,t=null),n=n||"xml",this.xmlFileUrl||(this.xmlFileUrl=e),this._data_type=n,this.xmlLoader.onloadAction=function(e,r,i,s,o){e.callEvent&&(o=e["_process_"+n](o),e._contextCallTimer||e.callEvent("onXLE",[e,0,0,o]),t&&(t(),t=null))},this.xmlLoader.loadXML(e)},loadXML:function(e,t){this.load(e,t,"xml")},parse:function(e,t,n){arguments.length==2&&typeof t!="function"&&(n=t,t=null),this._data_type=n=n||"xml",e=this["_process_"+n](e),this._contextCallTimer||this.callEvent("onXLE",[this,0,0,e]),t&&t()},xml:{top:"rows",row:"./row",cell:"./cell",s_row:"row",s_cell:"cell",row_attrs:[],cell_attrs:[]},csv:{row:"\n",cell:","},_xml_attrs:function(e){var t={};if(e.attributes.length)for(var n=0;n<e.attributes.length;n++)t[e.attributes[n].name]=e.attributes[n].value;return t},_process_xml:function(e){if(!e.doXPath){var t=new dtmlXMLLoaderObject(function(){});typeof e=="string"?t.loadXMLString(e):(t.xmlDoc=e.responseXML?e:{},t.xmlDoc.responseXML=e),e=t}if(this._refresh_mode)return this._refreshFromXML(e);this._parsing=!0;var n=e.getXMLTopNode(this.xml.top);if(n.tagName==this.xml.top){var r=n.getAttribute("dhx_security");r&&(dhtmlx.security_key=r),this._parseHead(n);
var i=e.doXPath(this.xml.row,n),s=parseInt(e.doXPath("//"+this.xml.top)[0].getAttribute("pos")||0),o=parseInt(e.doXPath("//"+this.xml.top)[0].getAttribute("total_count")||0),u=!1;o&&o!=this.rowsBuffer.length&&(this.rowsBuffer[o-1]||(this.rowsBuffer.length&&(u=!0),this.rowsBuffer[o-1]=null),o<this.rowsBuffer.length&&(this.rowsBuffer.splice(o,this.rowsBuffer.length-o),u=!0));if(this.isTreeGrid())return this._process_tree_xml(e);for(var a=0;a<i.length;a++)if(!this.rowsBuffer[a+s]){var f=i[a].getAttribute("id")||a+s+1;this.rowsBuffer[a+s]={idd:f,data:i[a],_parser:this._process_xml_row,_locator:this._get_xml_data},this.rowsAr[f]=i[a]}if(u&&this._srnd){var l=this.objBox.scrollTop;this._reset_view(),this.objBox.scrollTop=l}else this.render_dataset();return this._parsing=!1,e.xmlDoc.responseXML?e.xmlDoc.responseXML:e.xmlDoc}},_process_jsarray:function(a){this._parsing=!0,a&&a.xmlDoc&&(eval("dhtmlx.temp="+a.xmlDoc.responseText+";"),a=dhtmlx.temp);for(var b=0;b<a.length;b++){var c=b+1;this.rowsBuffer.push({idd:c,data:a[b],_parser:this._process_jsarray_row,_locator:this._get_jsarray_data}),this.rowsAr[c]=a[b]}this.render_dataset(),this._parsing=!1},_process_csv:function(e){this._parsing=!0,e.xmlDoc&&(e=e.xmlDoc.responseText),e=e.replace(/\r/g,""),e=e.split(this.csv.row);if(this._csvHdr){this.clearAll();var t=e.splice(0,1)[0].split(this.csv.cell);this._csvAID||t.splice(0,1),this.setHeader(t.join(this.delim)),this.init()}for(var n=0;n<e.length;n++)if(e[n]||n!=e.length-1){if(this._csvAID){var r=n+1;this.rowsBuffer.push({idd:r,data:e[n],_parser:this._process_csv_row,_locator:this._get_csv_data})}else{var i=e[n].split(this.csv.cell),r=i.splice(0,1)[0];this.rowsBuffer.push({idd:r,data:i,_parser:this._process_jsarray_row,_locator:this._get_jsarray_data})}this.rowsAr[r]=e[n]}this.render_dataset(),this._parsing=!1},_process_js:function(e){return this._process_json(e,"js")},_process_json:function(a,b){this._parsing=!0,a&&a.xmlDoc&&(eval("dhtmlx.temp="+a.xmlDoc.responseText+";"),a=dhtmlx.temp);if(b=="js"){a.data&&(a=a.data);for(var c=0;c<a.length;c++){var d=a[c],e=d.id||c+1;this.rowsBuffer.push({idd:e,data:d,_parser:this._process_js_row,_locator:this._get_js_data}),this.rowsAr[e]=a[c]}}else for(c=0;c<a.rows.length;c++)e=a.rows[c].id,this.rowsBuffer.push({idd:e,data:a.rows[c],_parser:this._process_json_row,_locator:this._get_json_data}),this.rowsAr[e]=a[c];a.dhx_security&&(dhtmlx.security_key=a.dhx_security),this.render_dataset(),this._parsing=!1},render_dataset:function(e,t){if(this._srnd){if(this._fillers)return this._update_srnd_view();t=Math.min(this._get_view_size()+(this._srnd_pr||0),this.rowsBuffer.length)}this.pagingOn?(e=Math.max(e||0,(this.currentPage-1)*this.rowsBufferOutSize),t=Math.min(this.currentPage*this.rowsBufferOutSize,this.rowsBuffer.length)):(e=e||0,t=t||this.rowsBuffer.length);for(var n=e;n<t;n++){var r=this.render_row(n);if(r==-1){this.xmlFileUrl&&this.callEvent("onDynXLS",[n,this._dpref?this._dpref:t-n])&&this.load(this.xmlFileUrl+getUrlSymbol(this.xmlFileUrl)+"posStart="+n+"&count="+(this._dpref?this._dpref:t-n),this._data_type),t=n;break}if(!r.parentNode||!r.parentNode.tagName)if(this._insertRowAt(r,n),r._attrs.selected||r._attrs.select)this.selectRow(r,r._attrs.call?!0:!1,!0),r._attrs.selected=r._attrs.select=null;if(this._ads_count&&n-e==this._ads_count){var i=this;return this._context_parsing=this._context_parsing||this._parsing,this._contextCallTimer=window.setTimeout(function(){i._contextCallTimer=null,i.render_dataset(n,t),i._contextCallTimer||(i._context_parsing?i.callEvent("onXLE",[]):i._fixAlterCss(),i.callEvent("onDistributedEnd",[]),i._context_parsing=!1)},this._ads_time)}}if(this._srnd&&!this._fillers){var s=this.rowsBuffer.length-t;for(this._fillers=[];s>0;){var o=_isIE?Math.min(s,5e4):s,u=this._add_filler(t,o);u&&this._fillers.push(u),s-=o,t+=o}}this.setSizes()},render_row:function(e){if(!this.rowsBuffer[e])return-1;if(this.rowsBuffer[e]._parser){var t=this.rowsBuffer[e];if(this.rowsAr[t.idd]&&this.rowsAr[t.idd].tagName=="TR")return this.rowsBuffer[e]=this.rowsAr[t.idd];var n=this._prepareRow(t.idd);return this.rowsBuffer[e]=n,this.rowsAr[t.idd]=n,t._parser.call(this,n,t.data),this._postRowProcessing(n),n}return this.rowsBuffer[e]},_get_cell_value:function(e,t,n){return e._locator?(this._c_order&&(t=this._c_order[t]),e._locator.call(this,e.data,t)):this.cells3(e,t)[n?n:"getValue"]()},sortRows:function(e,t,n){n=(n||"asc").toLowerCase(),t=t||this.fldSort[e],e=e||0;if(this.isTreeGrid())this.sortTreeRows(e,t,n);else{var r={},i=this.cellType[e],s="getValue";i=="link"&&(s="getContent");if(i=="dhxCalendar"||i=="dhxCalendarA")s="getDate";for(var o=0;o<this.rowsBuffer.length;o++)r[this.rowsBuffer[o].idd]=this._get_cell_value(this.rowsBuffer[o],e,s);this._sortRows(e,t,n,r)}this.callEvent("onAfterSorting",[e,t,n])},_sortCore:function(e,t,n,r,i){var s="sort";this._sst&&(i.stablesort=this.rowsCol.stablesort,s="stablesort"),t=="str"?i[s](function(e,t){return n=="asc"?r[e.idd]>r[t.idd]?1:-1:r[e.idd]<r[t.idd]?1:-1}):t=="int"?i[s](function(e,t){var i=parseFloat(r[e.idd]),i=isNaN(i)?-99999999999999:i,s=parseFloat(r[t.idd]),s=isNaN(s)?-99999999999999:s;return n=="asc"?i-s:s-i}):t=="date"&&i[s](function(e,t){var i=Date.parse(r[e.idd])||Date.parse("01/01/1900"),s=Date.parse(r[t.idd])||Date.parse("01/01/1900");return n=="asc"?i-s:s-i})},_sortRows:function(e,t,n,r){this._sortCore(e,t,n,r,this.rowsBuffer),this._reset_view(),this.callEvent("onGridReconstructed",[])},_reset_view:function(e){if(this.obj.rows[0]){this.callEvent("onResetView",[]);var t=this.obj.rows[0].parentNode,n=t.removeChild(t.childNodes[0],!0);if(_isKHTML)for(var r=t.parentNode.childNodes.length-1;r>=0;r--)t.parentNode.childNodes[r].tagName=="TR"&&t.parentNode.removeChild(t.parentNode.childNodes[r],!0);else if(_isIE)for(r=t.childNodes.length-1;r>=0;r--)t.childNodes[r].removeNode(!0);else t.innerHTML="";t.appendChild(n),this.rowsCol=dhtmlxArray(),this._sst&&this.enableStableSorting(!0),this._fillers=this.undefined,e||this.render_dataset()}},deleteRow:function(e,t){t||(t=this.getRowById(e));if(t){this.editStop();if(!this._realfake&&this.callEvent("onBeforeRowDeleted",[e])==0)return!1;var n=0;if(this.cellType._dhx_find("tree")!=-1&&!this._realfake)n=this._h2.get[e].parent.id,this._removeTrGrRow(t);else{t.parentNode&&t.parentNode.removeChild(t);var r=this.rowsCol._dhx_find(t);r!=-1&&this.rowsCol._dhx_removeAt(r);for(var i=0;i<this.rowsBuffer.length;i++)if(this.rowsBuffer[i]&&this.rowsBuffer[i].idd==e){this.rowsBuffer._dhx_removeAt(i),r=i;break}}this.rowsAr[e]=null;for(i=0;i<this.selectedRows.length;i++)this.selectedRows[i].idd==e&&this.selectedRows._dhx_removeAt(i);if(this._srnd){for(i=0;i<this._fillers.length;i++){var s=this._fillers[i];s&&(s[0]>=r?s[0]-=1:s[1]>=r&&(s[1]-=1))}this._update_srnd_view()}return this.pagingOn&&this.changePage(),this._realfake||this.callEvent("onAfterRowDeleted",[e,n]),this.callEvent("onGridReconstructed",[]),this._ahgr&&this.setSizes(),!0}},_addRow:function(e,t,n){if(n==-1||typeof n=="undefined")n=this.rowsBuffer.length;typeof t=="string"&&(t=t.split(this.delim));var r=this._prepareRow(e);r._attrs={};for(var i=0;i<r.childNodes.length;i++)r.childNodes[i]._attrs={};this.rowsAr[r.idd]=r,this._h2&&(this._h2.get[r.idd].buff=r),this._fillRow(r,t),this._postRowProcessing(r);if(this._skipInsert)return this._skipInsert=!1,this.rowsAr[r.idd]=r;if(this.pagingOn)return this.rowsBuffer._dhx_insertAt(n,r),this.rowsAr[r.idd]=r;if(this._fillers){this.rowsCol._dhx_insertAt(n,null),this.rowsBuffer._dhx_insertAt(n,r),this._fake&&this._fake.rowsCol._dhx_insertAt(n,null),this.rowsAr[r.idd]=r;for(var s=!1,o=0;o<this._fillers.length;o++){var u=this._fillers[o];u&&u[0]<=n&&u[0]+u[1]>=n&&(u[1]+=1,u[2].firstChild.style.height=parseInt(u[2].firstChild.style.height)+this._srdh+"px",s=!0,this._fake&&this._fake._fillers[o][1]++),u&&u[0]>n&&(u[0]+=1,this._fake&&this._fake._fillers[o][0]++)}return s||this._fillers.push(this._add_filler(n,1,n==0?{parentNode:this.obj.rows[0].parentNode,nextSibling:this.rowsCol[1]}:this.rowsCol[n-1])),r}return this.rowsBuffer._dhx_insertAt(n,r),this._insertRowAt(r,n)},addRow:function(e,t,n){var r=this._addRow(e,t,n);return this.dragContext||this.callEvent("onRowAdded",[e]),this.pagingOn&&this.changePage(this.currentPage),this._srnd&&this._update_srnd_view(),r._added=!0,this._ahgr&&this.setSizes(),this.callEvent("onGridReconstructed",[]),r},_insertRowAt:function(e,t,n){return this.rowsAr[e.idd]=e,this._skipInsert?(this._skipInsert=!1,e):(t<0||!t&&parseInt(t)!==0?t=this.rowsCol.length:t>this.rowsCol.length&&(t=this.rowsCol.length),this._cssEven&&(e.className+=(this._cssSP?this.getLevel(e.idd):t)%2==1?" "+this._cssUnEven+(this._cssSU?" "+this._cssUnEven+"_"+this.getLevel(e.idd):""):" "+this._cssEven+(this._cssSU?" "+this._cssEven+"_"+this.getLevel(e.idd):"")),n||(t==this.obj.rows.length-1||!this.rowsCol[t]?_isKHTML?this.obj.appendChild(e):this.obj.firstChild.appendChild(e):this.rowsCol[t].parentNode.insertBefore(e,this.rowsCol[t])),this.rowsCol._dhx_insertAt(t,e),this.callEvent("onRowInserted",[e,t]),e)},getRowById:function(e){var t=this.rowsAr[e];if(t){if(t.tagName!="TR"){for(var n=0;n<this.rowsBuffer.length;n++)if(this.rowsBuffer[n]&&this.rowsBuffer[n].idd==e)return this.render_row(n);if(this._h2)return this.render_row(null,t.idd)}return t}return null},cellById:function(e,t){return this.cells(e,t)},cells:function(e,t){if(arguments.length==0)return this.cells4(this.cell);var n=this.getRowById(e),r=n._childIndexes?n.childNodes[n._childIndexes[t]]:n.childNodes[t];return this.cells4(r)},cellByIndex:function(e,t){return this.cells2(e,t)},cells2:function(e,t){var n=this.render_row(e),r=n._childIndexes?n.childNodes[n._childIndexes[t]]:n.childNodes[t];return this.cells4(r)},cells3:function(e,t){var n=e._childIndexes?e.childNodes[e._childIndexes[t]]:e.childNodes[t];return this.cells4(n)},cells4:function(e){var t=window["eXcell_"+(e._cellType||this.cellType[e._cellIndex])];if(t)return new t(e)},cells5:function(e,t){t=t||e._cellType||this.cellType[e._cellIndex];if(!this._ecache[t]){var n=window["eXcell_"+t]?window["eXcell_"+t]:eXcell_ro;this._ecache[t]=new n(e)}return this._ecache[t].cell=e,this._ecache[t]},dma:function(e){this._ecache||(this._ecache={}),e&&!this._dma?(this._dma=this.cells4,this.cells4=this.cells5):!e&&this._dma&&(this.cells4=this._dma,this._dma=null)},getRowsNum:function(){return this.rowsBuffer.length},enableEditTabOnly:function(e){this.smartTabOrder=arguments.length>0?convertStringToBoolean(e):!0},setExternalTabOrder:function(e,t){var n=this;this.tabStart=typeof e=="object"?e:document.getElementById(e),this.tabStart.onkeydown=function(e){var t=e||window.event;if(t.keyCode==9&&!t.shiftKey)return t.cancelBubble=!0,n.selectCell(0,0,0,0,1),n.smartTabOrder&&n.cells2(0,0).isDisabled()&&n._key_events.k9_0_0.call(n),this.blur(),!1},_isOpera&&(this.tabStart.onkeypress=this.tabStart.onkeydown),this.tabEnd=typeof t=="object"?t:document.getElementById(t),this.tabEnd.onkeydown=this.tabEnd.onkeypress=function(e){var t=e||window.event;if(t.keyCode==9&&t.shiftKey)return t.cancelBubble=!0,n.selectCell(n.getRowsNum()-1,n.getColumnCount()-1,0,0,1),n.smartTabOrder&&n.cells2(n.getRowsNum()-1,n.getColumnCount()-1).isDisabled()&&n._key_events.k9_0_1.call(n),this.blur(),!1},_isOpera&&(this.tabEnd.onkeypress=this.tabEnd.onkeydown)},uid:function(){return this._ui_seed||(this._ui_seed=(new Date).valueOf()),this._ui_seed++},clearAndLoad:function(){var e=this._pgn_skin;this._pgn_skin=null,this.clearAll(),this._pgn_skin=e,this.load.apply(this,arguments)},getStateOfView:function(){if(this.pagingOn){var e=(this.currentPage-1)*this.rowsBufferOutSize;return[this.currentPage,e,Math.min(e+this.rowsBufferOutSize,this.rowsBuffer.length),this.rowsBuffer.length]}return[Math.floor(this.objBox.scrollTop/this._srdh),Math.ceil(parseInt(this.objBox.offsetHeight)/this._srdh),this.rowsBuffer.length]}},function(){function e(e,t){this[e]=t}function t(e,t){this[e].call(this,t)}function n(e,t){this[e].call(this,t.join(this.delim))}function r(e,t){for(var n=0;n<t.length;n++)if(typeof t[n]=="object"){var r=this.getCombo(n),i;for(i in t[n])r.put(i,t[n][i])}}function i(e,t){function n(e,t,n){i[t]||(i[t]=[]),typeof n=="object"&&(n.toString=function(){return this.text}),i[t][e]=n}for(var r=1,i=[],s=0;s<t.length;s++)if(typeof t[s]=="object"&&t[s].length)for(var o=0;o<t[s].length;o++)n(s,o,t[s][o]);else n(s,0,t[s]);for(s=0;s<i.length;s++)for(o=0;o<i[0].length;o++){var u=i[s][o];i[s][o]=(u||"").toString()||"&nbsp;";if(u&&u.colspan)for(var a=1;a<u.colspan;a++)n(o+a,s,"#cspan");if(u&&u.rowspan)for(a=1;a<u.rowspan;a++)n(o,s+a,"#rspan")}this.setHeader(i[0]);for(s=1;s<i.length;s++)this.attachHeader(i[s])}var s=[{name:"label",def:"&nbsp;",operation:"setHeader",type:i},{name:"id",def:"",operation:"columnIds",type:e},{name:"width",def:"*",operation:"setInitWidths",type:n},{name:"align",def:"left",operation:"cellAlign",type:e},{name:"valign",def:"middle",operation:"cellVAlign",type:e},{name:"sort",def:"na",operation:"fldSort",type:e},{name:"type",def:"ro",operation:"setColTypes",type:n},{name:"options",def:"",operation:"",type:r}];dhtmlx.extend_api("dhtmlXGridObject",{_init:function(e){return[e.parent]},image_path:"setImagePath",columns:"columns",rows:"rows",headers:"headers",skin:"setSkin",smart_rendering:"enableSmartRendering",css:"enableAlterCss",auto_height:"enableAutoHeight",save_hidden:"enableAutoHiddenColumnsSaving",save_cookie:"enableAutoSaving",save_size:"enableAutoSizeSaving",auto_width:"enableAutoWidth",block_selection:"enableBlockSelection",csv_id:"enableCSVAutoID",csv_header:"enableCSVHeader",cell_ids:"enableCellIds",colspan:"enableColSpan",column_move:"enableColumnMove",context_menu:"enableContextMenu",distributed:"enableDistributedParsing",drag:"enableDragAndDrop",drag_order:"enableDragOrder",tabulation:"enableEditTabOnly",header_images:"enableHeaderImages",header_menu:"enableHeaderMenu",keymap:"enableKeyboardSupport",mouse_navigation:"enableLightMouseNavigation",markers:"enableMarkedCells",math_editing:"enableMathEditing",math_serialization:"enableMathSerialization",drag_copy:"enableMercyDrag",multiline:"enableMultiline",multiselect:"enableMultiselect",save_column_order:"enableOrderSaving",hover:"enableRowsHover",rowspan:"enableRowspan",smart:"enableSmartRendering",save_sorting:"enableSortingSaving",stable_sorting:"enableStableSorting",undo:"enableUndoRedo",csv_cell:"setCSVDelimiter",date_format:"setDateFormat",drag_behavior:"setDragBehavior",editable:"setEditable",without_header:"setNoHeader",submit_changed:"submitOnlyChanged",submit_serialization:"submitSerialization",submit_selected:"submitOnlySelected",submit_id:"submitOnlyRowID",xml:"load"},{columns:function(e){for(var n=0;n<s.length;n++){for(var r=[],i=0;i<e.length;i++)r[i]=e[i][s[n].name]||s[n].def;var o=s[n].type||t;o.call(this,s[n].operation,r,e)}this.init()},rows:function(){},headers:function(e){for(var t=0;t<e.length;t++)this.attachHeader(e[t])}})}(),dhtmlXGridObject.prototype._dp_init=function(e){e.attachEvent("insertCallback",function(e,t){this.obj._h2?this.obj.addRow(t,n,null,parent):this.obj.addRow(t,[],0);var n=this.obj.getRowById(t);n&&(this.obj._process_xml_row(n,e.firstChild),this.obj._postRowProcessing(n))}),e.attachEvent("updateCallback",function(e,t){var n=this.obj.getRowById(t);n&&(this.obj._process_xml_row(n,e.firstChild),this.obj._postRowProcessing(n))}),e.attachEvent("deleteCallback",function(e,t){this.obj.setUserData(t,this.action_param,"true_deleted"),this.obj.deleteRow(t)}),e._methods=["setRowTextStyle","setCellTextStyle","changeRowId","deleteRow"],this.attachEvent("onEditCell",function(t,n,r){if(e._columns&&!e._columns[r])return!0;var i=this.cells(n,r);return t==1?i.isCheckbox()&&e.setUpdated(n,!0):t==2&&i.wasChanged()&&e.setUpdated(n,!0),!0}),this.attachEvent("onRowPaste",function(t){e.setUpdated(t,!0)}),this.attachEvent("onRowIdChange",function(t,n){var r=e.findRow(t);r<e.updatedRows.length&&(e.updatedRows[r]=n)}),this.attachEvent("onSelectStateChanged",function(){return e.updateMode=="row"&&e.sendData(),!0}),this.attachEvent("onEnter",function(){return e.updateMode=="row"&&e.sendData(),!0}),this.attachEvent("onBeforeRowDeleted",function(t){if(!this.rowsAr[t])return!0;if(this.dragContext&&e.dnd)return window.setTimeout(function(){e.setUpdated(t,!0)},1),!0;var n=e.getState(t);return this._h2&&this._h2.forEachChild(t,function(t){e.setUpdated(t.id,!1),e.markRow(t.id,!0,"deleted")},this),n=="inserted"?(e.set_invalid(t,!1),e.setUpdated(t,!1),!0):n=="deleted"?!1:n=="true_deleted"?(e.setUpdated(t,!1),!0):(e.setUpdated(t,!0,"deleted"),!1)}),this.attachEvent("onBindUpdate",function(t){e.setUpdated(t,!0)}),this.attachEvent("onRowAdded",function(t){return this.dragContext&&e.dnd?!0:(e.setUpdated(t,!0,"inserted"),!0)}),e._getRowData=function(e){var t=[];t.gr_id=e,this.obj.isTreeGrid()&&(t.gr_pid=this.obj.getParentId(e));for(var n=this.obj.getRowById(e),r=0;r<this.obj._cCount;r++){var i=this.obj._c_order?this.obj._c_order[r]:r,s=this.obj.cells(n.idd,r);if(!this._changed||s.wasChanged())this._endnm?t[this.obj.getColumnId(r)]=s.getValue():t["c"+i]=s.getValue()}var o=this.obj.UserData[e];if(o)for(var u=0;u<o.keys.length;u++)o.keys[u]&&o.keys[u].indexOf("__")!=0&&(t[o.keys[u]]=o.values[u]);if(o=this.obj.UserData.gridglobaluserdata)for(u=0;u<o.keys.length;u++)t[o.keys[u]]=o.values[u];return t},e._clearUpdateFlag=function(e){var t=this.obj.getRowById(e);if(t)for(var n=0;n<this.obj._cCount;n++)this.obj.cells(e,n).cell.wasChanged=!1},e.checkBeforeUpdate=function(e){for(var t=!0,n=[],r=0;r<this.obj._cCount;r++)if(this.mandatoryFields[r]){var i=this.mandatoryFields[r].call(this.obj,this.obj.cells(e,r).getValue(),e,r);typeof i=="string"?(this.messages.push(i),t=!1):(t&=i,n[r]=!i)}return t||(this.set_invalid(e,"invalid",n),this.setUpdated(e,!1)),t}};